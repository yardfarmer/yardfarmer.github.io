<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | output stream</title>
  <meta name="author" content="yakun.cyk">
  
  <meta name="description" content="主要内容可能关于 web 技术，感慨心得...">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="output stream"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	    <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
	  <a class="navbar-brand" href="/">output stream</a>
      <div class="collapse navbar-collapse nav-menu">
		    <ul class="nav navbar-nav">
    		  
    		  <li>
    			 <a href="/demos" title="Demos.">
            <i class="fa fa-flask"></i>Demos
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/archives" title="All the articles.">
            <i class="fa fa-archive"></i>归档
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/about" title="About me.">
            <i class="fa fa-user"></i>关于我
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/#" title="Search Posts.">
            <i class="fa fa-search"></i>搜索
    			 </a>
    		  </li>
    		  
    		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <!--
        <i class="fa fa-heart"></i> 
      -->
      
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2014-08-07-改键/" >mac os 改键</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>最近着迷于vim,<code>Vim使用技巧</code>推荐重新映射大小写转换键</p>
<blockquote>
<p>在现代键盘上，<code>&lt;Esc&gt;</code>可以省很多力气，尤其是Vim对<code>&lt;Esc&gt;</code>键用的这么频繁。不过最好好把大小写转换键映射为<code>&lt;Ctrl&gt;</code>键。<code>&lt;C-[&gt;</code> 的功能和 <esc> 键相同，如果 <code>&lt;Ctrl&gt;</code> 键触手可及，那么这一组合键用起来也会很容易。</esc></p>
</blockquote>
<p>我用的改建软件是 karabiner 和 seil。</p>

	
	</div>
  <a type="button" href="/2017/02/01/2014-08-07-改键/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-01-03 </div>
			<div class="article-title"><a href="/2017/01/03/新的一年-2017/" title="介绍下使用 fenced-code.">Hello 2017</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
           
              <div class="thumbnail"><a href="/2017/01/03/新的一年-2017/"><img src="http://7i7gr4.com1.z0.glb.clouddn.com/2017-01-03-14834300366651.jpg" alt="Hello 2017"  class="nofancybox"></a>
           
		</div>
	
	
		<h1 id="hello-2017"><a href="#hello-2017" class="headerlink" title="hello, 2017"></a>hello, 2017</h1><h2 id="关于-hexo-filter-fenced-code-使用"><a href="#关于-hexo-filter-fenced-code-使用" class="headerlink" title="关于 hexo-filter-fenced-code 使用"></a>关于 <code>hexo-filter-fenced-code</code> 使用</h2><ul>
<li>5个 “`” 执行不显示</li>
<li>4个 “`” 显示并执行</li>
</ul>
<h3 id="ok-用起来还不错"><a href="#ok-用起来还不错" class="headerlink" title="ok 用起来还不错"></a>ok 用起来还不错</h3><div class="hexo-insert-code">  <div id="colorbox"></div>
  <button id="demo-button">Click Me</button></div>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'demo-button'</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> randomColor = <span class="string">'#'</span> + <span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>,<span class="number">6</span>);</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'colorbox'</span>).innerHTML = randomColor;</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'colorbox'</span>).style.background = randomColor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<script>  document.getElementById('demo-button').onclick = function() {
    var randomColor = '#' + Math.random().toString().substr(2,6);
    document.getElementById('colorbox').innerHTML = randomColor;
    document.getElementById('colorbox').style.background = randomColor;
  }</script>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#colorbox</span> &#123;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">150px</span>;</div><div class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">  <span class="attribute">line-height</span>: <span class="number">150px</span>;</div><div class="line">  <span class="attribute">text-align</span>: center;</div><div class="line">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</div><div class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">&#125;</div><div class="line">  <span class="selector-id">#demo-button</span> &#123;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<style type="text/css">  #colorbox {
    border: 1px solid #ddd;
    height: 150px;
    width: 200px;
    line-height: 150px;
    text-align: center;
    margin-bottom: 20px;
    color: #fff;
  }
    #demo-button {
    padding: 5px 10px;
  }</style>
<h2 id="来张张图片"><a href="#来张张图片" class="headerlink" title="来张张图片"></a>来张张图片</h2><p><img src="http://7i7gr4.com1.z0.glb.clouddn.com/2017-01-03-屏幕快照 2017-01-03 15.47.54 -2-.png" alt="屏幕快照 2017-01-03 15.47.54 -2-"></p>

	
	</div>
  <a type="button" href="/2017/01/03/新的一年-2017/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/软件设计原则/" >软件设计原则</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##一. 六大设计原则</p>
<p>###1. 单一职责原则（Single Responsibility Principle - SRP）</p>
<p>原文：</p>
<blockquote>
<p>There should never be more than one reason for a class to change.</p>
</blockquote>
<p>译文：</p>
<p>永远不应该有多于一个原因来改变某个类。</p>
<p>理解：</p>
<p>对于一个类而言，应该仅有一个引起它变化的原因。说白了就是，不同的类具备不同的职责，各施其责。这就好比一个团队，大家分工协作，互不影响，各做各的事情。</p>
<p>应用：</p>
<p>当我们做系统设计时，如果发现有一个类拥有了两种的职责，那就问自己一个问题：可以将这个类分成两个类吗？如果真的有必要，那就分吧。千万不要让一个类干的事情太多！</p>
<p>###2. 开放封闭原则（Open Closed Principle - OCP）</p>
<p>原文：</p>
<blockquote>
<p>Software entities like classes, modules and functions should be open for extension but closed for modifications.</p>
</blockquote>
<p>译文：</p>
<p>软件实体，如：类、模块与函数，对于扩展应该是开放的，但对于修改应该是封闭的。</p>
<p>理解：</p>
<p>简言之，对扩展开放，对修改封闭。换句话说，可以去扩展类，但不要去修改类。</p>
<p>应用：</p>
<p>当需求有改动，要修改代码了，此时您要做的是，尽量用继承或组合的方式来扩展类的功能，而不是直接修改类的代码。当然，如果能够确保对整体架构不会产生任何影响，那么也没必要搞得那么复杂了，直接改这个类吧。</p>
<p>###3. 里氏替换原则（Liskov Substitution Principle - LSP）</p>
<p>原文：</p>
<blockquote>
<p>Functions that use pointers or references to base classes must be able to use objects of derived classes without knowing it.</p>
</blockquote>
<p>译文：</p>
<p>使用基类的指针或引用的函数，必须是在不知情的情况下，能够使用派生类的对象。</p>
<p>理解：</p>
<p>父类能够替换子类，但子类不一定能替换父类。也就是说，在代码中可以将父类全部替换为子类，程序不会报错，也不会在运行时出现任何异常，但反过来却不一定成立。</p>
<p>应用：</p>
<p>在继承类时，务必重写（Override）父类中所有的方法，尤其需要注意父类的 protected 方法（它们往往是让您重写的），子类尽量不要暴露自己的 public 方法供外界调用。</p>
<p>###4. 最少知识原则（Least Knowledge Principle - LKP）</p>
<p>原文：</p>
<blockquote>
<p>Only talk to you immediate friends.</p>
</blockquote>
<p>译文：</p>
<p>只与你最直接的朋友交流。</p>
<p>理解：</p>
<p>尽量减少对象之间的交互，从而减小类之间的耦合。简言之，一定要做到：低耦合，高内聚。</p>
<p>应用：</p>
<p>在做系统设计时，不要让一个类依赖于太多的其他类，需尽量减小依赖关系，否则，您死都不知道自己怎么死的。</p>
<p>该原则也称为“迪米特法则（Law of Demeter）”，由 Ian Holland 提出。</p>
<p>###5. 接口隔离原则（Interface Segregation Principle - ISP）</p>
<p>原文：</p>
<blockquote>
<p>The dependency of one class to another one should depend on the smallest possible interface.</p>
</blockquote>
<p>译文：</p>
<p>一个类与另一个类之间的依赖性，应该依赖于尽可能小的接口。</p>
<p>理解：</p>
<p>不要对外暴露没有实际意义的接口。也就是说，接口是给别人调用的，那就不要去为难别人了，尽可能保证接口的实用性吧。</p>
<p>应用：</p>
<p>当需要对外暴露接口时，需要再三斟酌，如果真的没有必要对外提供的，就删了吧。一旦您提供了，就意味着，您将来要多做一件事情，何苦要给自己找事做呢。</p>
<blockquote>
<ol>
<li>依赖倒置原则（Dependence Inversion Principle - DIP）</li>
</ol>
</blockquote>
<p>原文：</p>
<p>High level modules should not depends upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions.</p>
<p>译文：</p>
<p>高层模块不应该依赖于低层模块，它们应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。</p>
<p>理解：</p>
<p>应该面向接口编程，不应该面向实现类编程。面向实现类编程，相当于就是论事，那是正向依赖（正常人思维）；面向接口编程，相当于通过事物表象来看本质，那是反向依赖，即依赖倒置（程序员思维）。</p>
<p>应用：</p>
<p>并不是说，所有的类都要有一个对应的接口，而是说，如果有接口，那就尽量使用接口来编程吧。</p>
<p>将以上六大原则的英文首字母拼在一起就是 SOLID（稳定的），所以也称之为 SOLID 原则。</p>
<p>##二、补充设计原则</p>
<p>###1. 组合/聚合复用原则（Composition/Aggregation Reuse Principle - CARP）</p>
<p>当要扩展类的功能时，优先考虑使用组合，而不是继承。这条原则在 23 种经典设计模式中频繁使用，如：代理模式、装饰模式、适配器模式等。可见江湖地位非常之高！</p>
<p>###2. 无环依赖原则（Acyclic Dependencies Principle - ADP）</p>
<p>当 A 模块依赖于 B 模块，B 模块依赖于 C 模块，C 依赖于 A 模块，此时将出现循环依赖。在设计中应该避免这个问题，可通过引入“中介者模式”解决该问题。</p>
<p>###3. 共同封装原则（Common Closure Principle - CCP）</p>
<p>应该将易变的类放在同一个包里，将变化隔离出来。该原则是“开放-封闭原则”的延生。</p>
<p>###4. 共同重用原则（Common Reuse Principle - CRP）</p>
<p>如果重用了包中的一个类，那么也就相当于重用了包中的所有类，我们要尽可能减小包的大小。</p>
<p>###5. 好莱坞原则（Hollywood Principle - HP）</p>
<p>好莱坞明星的经纪人一般都很忙，他们不想被打扰，往往会说：<code>Don&#39;t call me, I&#39;ll call you.</code> 翻译为：不要联系我，我会联系你。对应于软件设计而言，最著名的就是“控制反转”（或称为“依赖注入”），我们不需要在代码中主动的创建对象，而是由容器帮我们来创建并管理这些对象。</p>
<p>##三、其他设计原则</p>
<p>###1. 不要重复你自己（Don’t repeat yourself - DRY）</p>
<p>不要让重复的代码到处都是，要让它们足够的重用，所以要尽可能地封装。</p>
<p>###2. 保持它简单与傻瓜（Keep it simple and stupid - KISS）</p>
<p>不要让系统变得复杂，界面简洁，功能实用，操作方便，要让它足够的简单，足够的傻瓜。</p>
<p>###3. 高内聚与低耦合（High Cohesion and Low Coupling - HCLC）</p>
<p>模块内部需要做到内聚度高，模块之间需要做到耦合度低。</p>
<p>###4. 惯例优于配置（Convention over Configuration - COC）</p>
<p>尽量让惯例来减少配置，这样才能提高开发效率，尽量做到“零配置”。很多开发框架都是这样做的。</p>
<p>###5. 命令查询分离（Command Query Separation - CQS）</p>
<p>在定义接口时，要做到哪些是命令，哪些是查询，要将它们分离，而不要揉到一起。</p>
<p>###6. 关注点分离（Separation of Concerns - SOC）</p>
<p>将一个复杂的问题分离为多个简单的问题，然后逐个解决这些简单的问题，那么这个复杂的问题就解决了。难就难在如何进行分离。</p>
<p>###7. 契约式设计（Design by Contract - DBC）</p>
<p>模块或系统之间的交互，都是基于契约（接口或抽象）的，而不要依赖于具体实现。该原则建议我们要面向契约编程。</p>
<p>###8. 你不需要它（You aren’t gonna need it - YAGNI）</p>
<p>不要一开始就把系统设计得非常复杂，不要陷入“过度设计”的深渊。应该让系统足够的简单，而却又不失扩展性，这是其中的难点。</p>

	
	</div>
  <a type="button" href="/2015/10/23/软件设计原则/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/测试工具-Mock-的使用-资料整理中/" >测试工具 Mock 的使用(资料整理中)</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>因为重构，所以需要测试。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>###单元测试<br>单元测试主要包含断言，测试框架，测试用例，测试覆盖率，mock，持续集成等几个方面：</p>
<p>Mocha 支持你用任何一种断言库，无论是should.js、chai、expect.js、better-assert等等。也可以用node原始的assert。</p>
<p>###测试风格<br>Mocha支持BDD（行为驱动开发）和TDD（测试驱动开发）两种测试风格，BDD对于TDD来说在关注点更关注整体行为是否符合预期，在表达方式上更接近于自然语言的习惯。Mocha的默认模式是BDD，在此我们只关注BDD模式。</p>
<p>###钩子函数<br>BDD风格的钩子函数有：before, after, beforeEach, afterEach 典型BDD风格测试：</p>

	
	</div>
  <a type="button" href="/2015/10/23/测试工具-Mock-的使用-资料整理中/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/怎么写出好代码/" >怎么写出好代码</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>很难定义什么是好代码，但是坏代码是显而易见的。</p>
</blockquote>
<p>##良性循环</p>
<p>对已经具有可测试性、可维护性、可理解性的代码进行测试和维护，可以让工作更简单。有了这个基础，可以让我们更富有成效，富有成效的人时快乐的，快乐的人也是富有成效的。这是一个良性循环。 </p>
<h2 id="理论摘录"><a href="#理论摘录" class="headerlink" title="理论摘录"></a>理论摘录</h2><ol>
<li>重构的基本技巧: 小步前进，频繁测试。</li>
<li>对象技术的要点在于：将数据和对数据的操作行为包装在一起。</li>
<li>封装：对外部世界隐藏内部细节。 </li>
<li>可以让函数保持最小代码量的一个方法是让命令（Command）和查询（Query）保持分离。命令函数表示 do something, 而查询函数表示 return something。</li>
</ol>
<p>##代码的坏味道</p>
<ol>
<li>Duplicated Code（重复的代码）<ul>
<li>合并重复的代码，提取，使之独立出来</li>
</ul>
</li>
<li>Long Method（长函数）<ul>
<li>一个函数越长，圈复杂度就越大，容易出问题的点就越多，并且需要的脑容量也更大，还会导致在修复 bug 的时候，产生新 bug 的概率加大。</li>
<li>原则：每当感觉需要使用注释说明点什么的时候，就把需要说明的东西写入到一个独立的函数中。</li>
</ul>
</li>
<li>Long Parameter List（过长参数列）</li>
<li>Divergent Change（发散式变化）<ul>
<li>一个类受多种变化的影响</li>
<li>一旦需要修改，最好只修改一处</li>
</ul>
</li>
<li>Shotgun Surgery（散弹式修改）<ul>
<li>一种变化引发多个类需要修改</li>
<li>每遇到某种变化，都必须在许多不同的类内做出许多小修改</li>
</ul>
</li>
<li>Feature Envy（依恋情节）<ul>
<li>某个函数为了计算某个值，从另一个对象那调用了多个取值函数</li>
</ul>
</li>
<li>Data Clumps（数据泥团）<ul>
<li>两个类中相同的字段，许多函数中相同的参数等绑在一起出现的数据，提炼成对象</li>
</ul>
</li>
<li>Switch Statement<ul>
<li>面向对象程序的一个显著特征：少用 switch 语句，多用多态。</li>
</ul>
</li>
<li>Complicated Condition（复杂的条件判断）<ul>
<li>把需要注释说明的分支条件，提炼成单独的一个函数</li>
</ul>
</li>
<li>Proper Iterator（合理使用循环）<ul>
<li>如果有些代码实际上是重复性的工作，那么合理的使用循环会使代码量更少</li>
</ul>
</li>
<li>Only One Return（函数只有一个出口）<ul>
<li>提前让函数退出，代替嵌套条件分支</li>
<li>避免 if 分支的左右括号之间相隔 500 米</li>
</ul>
</li>
</ol>

	
	</div>
  <a type="button" href="/2015/10/23/怎么写出好代码/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/node-stream/" >node stream</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##引子<br>最近编写 gulp-gaea 插件时用到了遇到了 <code>stream</code> 的问题， 在这里总结一下。在node中，流可以帮助我们将事情的重点分为几份，因为使用流可以帮助我们将实现接口的部分分割成一些连续的接口，这些接口都是可重用的。接着，你可以将一个流的输出口接到另一个流的输入口，然后使用使用一些库来对流实现高级别的控制。相比 java 的复杂庞大的 IO 接口，node 的接口简单了很多。</p>
<p>##使用流的好处</p>
<p>在node中，I/O都是异步的，所以在和硬盘以及网络的交互过程中会涉及到传递回调函数的过程。你之前可能会写出这样的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">    fs.readFile(__dirname + <span class="string">'/data.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</div><div class="line">        res.end(data);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line">server.listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<p>上面的这段代码并没有什么问题，但是在每次请求时，我们都会把整个data.txt文件读入到内存中，然后再把结果返回给客户端。如果data.txt文件非常大，在响应大量用户的并发请求时，程序可能会消耗大量的内存，这样很可能会造成用户连接缓慢的问题。</p>
<p>所幸的是，(req,res)参数都是流对象，这意味着我们可以使用一种更好的方法来实现上面的需求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> stream = fs.createReadStream(__dirname + <span class="string">'/data.txt'</span>);</div><div class="line">    stream.pipe(res);</div><div class="line">&#125;);</div><div class="line">server.listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<p>在这里，.pipe()方法会自动帮助我们监听data和end事件。上面的这段代码不仅简洁，而且data.txt文件中每一小段数据都将源源不断的发送到客户端, 还有一个好处就是，如果流出的慢了， 那么会自动减少数据的读入，减少对内存的压力。</p>
<p>##node的流模块</p>
<p>在node中，一共有五种类型的流：readable,writable,transform,duplex以及”classic”。</p>
<p>###pipe</p>
<p>无论哪一种流，都会使用.pipe()方法来实现输入和输出。</p>
<p><code>.pipe()</code> 函数很简单，它仅仅是接受一个源头<code>src</code>并将数据输出到一个可写的流<code>dst</code>中：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">src</span><span class="selector-class">.pipe</span>(<span class="selector-tag">dst</span>)</div><div class="line"><span class="selector-class">.pipe</span>(<span class="selector-tag">dst</span>)</div></pre></td></tr></table></figure>
<p>将会返回dst因此你可以链式调用多个流:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">a</span><span class="selector-class">.pipe</span>(<span class="selector-tag">b</span>)<span class="selector-class">.pipe</span>(<span class="selector-tag">c</span>)<span class="selector-class">.pipe</span>(<span class="selector-tag">d</span>)</div></pre></td></tr></table></figure>
<p>上面的代码也可以等价为：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a.pipe(b)<span class="comment">;</span></div><div class="line">b.pipe(c)<span class="comment">;</span></div><div class="line">c.pipe(d)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>类似 unix 中编写流代码很类似：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a | <span class="type">b</span> | <span class="type">c</span> | <span class="type">d</span></div></pre></td></tr></table></figure></p>
<p>###readable流</p>
<p><code>Readable</code> 流可以产出数据，你可以将这些数据传送到一个 <code>writable</code>，<code>transform</code> 或者 <code>duplex</code> 流中，只需要调用<code>pipe()</code>方法:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">readableStream</span><span class="selector-class">.pipe</span>(<span class="selector-tag">dst</span>)</div></pre></td></tr></table></figure>
<p>创建一个readable流</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var Readable = require(<span class="string">'stream'</span>).Readable;</div><div class="line"></div><div class="line">var rs = <span class="keyword">new</span> Readable;</div><div class="line">rs.<span class="keyword">push</span>(<span class="string">'beep '</span>);</div><div class="line">rs.<span class="keyword">push</span>(<span class="string">'boop\n'</span>);</div><div class="line">rs.<span class="keyword">push</span>(<span class="keyword">null</span>);</div><div class="line">rs.pipe(process.stdout);</div></pre></td></tr></table></figure>
<p>下面运行代码：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">beep</span> boop</div></pre></td></tr></table></figure>
<p><strong>在上面的代码中rs.push(null)的作用是告诉rs输出数据应该结束了。</strong></p>
<p>需要注意的一点是我们在将数据输出到 process.stdout 之前已经将内容推送进readable流rs中，但是所有的数据依然是可写的。</p>
<p>这是因为在你使用.push()将数据推进一个readable流中时，一直要到另一个东西来消耗数据之前，数据都会存在一个缓存中。</p>
<p>可以使用util.inherit()来继承一个Readable流。</p>
<p>###消耗一个readable流</p>
<p>大部分时候，将一个readable流直接 pipe 到另一种类型的流或者使用<code>through</code> 创建的流中，是一件很容易的事情。但是有时我们也会需要直接来消耗一个readable流。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">process.stdin.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> buf = process.stdin.read();</div><div class="line">    <span class="built_in">console</span>.dir(buf);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>当数据可用时，readable事件将会被触发，可以调用.read()方法来从缓存中获取这些数据。</p>
<p>当流结束时，.read()将返回null，因为此时已经没有更多的字节可以供我们获取了。</p>
<p>也可以告诉.read()方法来返回n个字节的数据。</p>
<p>下面是一个例子，在这里我们制定每次读取3个字节的数据：</p>
<p>process.stdin.on(‘readable’, function () {<br>    var buf = process.stdin.read(3);<br>    console.dir(buf);<br>});</p>
<p>###writable流</p>
<p>一个writable流指的是只能流进不能流出的流:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">src</span><span class="selector-class">.pipe</span>(<span class="selector-tag">writableStream</span>)</div></pre></td></tr></table></figure>
<p>####创建一个writable流</p>
<p>只需要定义一个._write(chunk,enc,next)函数，你就可以将一个readable流的数据释放到其中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Writable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Writable;</div><div class="line"><span class="keyword">var</span> ws = Writable();</div><div class="line">ws._write = <span class="function"><span class="keyword">function</span> (<span class="params">chunk, enc, next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.dir(chunk);</div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"></div><div class="line">process.stdin.pipe(ws);</div></pre></td></tr></table></figure>
<p>第一个参数，chunk代表写进来的数据。</p>
<p>第二个参数enc代表编码的字符串，但是只有在opts.decodeString为false的时候你才可以写一个字符串。</p>
<p>第三个参数，next(err)是一个回调函数，使用这个回调函数你可以告诉数据消耗者可以写更多的数据。你可以有选择性的传递一个错误对象error，这时会在流实体上触发一个emit事件。</p>
<p><strong>在从一个readable流向一个writable流传数据的过程中，数据会自动被转换为Buffer对象</strong>，除非你在创建writable流的时候制定了<code>decodeStrings</code>参数为false,  <code>Writable({decodeStrings: false})</code>。</p>
<p>如果你需要传递对象，需要指定objectMode参数为true，<code>Writable({ objectMode: true })</code>。</p>
<p>####向一个writable流中写东西</p>
<p>如果需要向一个writable流中写东西，只需要调用.write(data)即可。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">process</span>.stdout.<span class="built_in">write</span>(<span class="string">'beep boop\n'</span>);</div></pre></td></tr></table></figure>
<p>为了告诉一个writable流你已经写完毕了，只需要调用.end()方法。<strong>你也可以使用.end(data)在结束前再写一些数据。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> ws = fs.createWriteStream(<span class="string">'message.txt'</span>);</div><div class="line"></div><div class="line">ws.write(<span class="string">'beep '</span>);</div><div class="line"></div><div class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    ws.end(<span class="string">'boop\n'</span>);</div><div class="line">&#125;, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<p>###transform流</p>
<p>你可以将 <code>transform</code> 流想象成一个流的中间部分，它可以读也可写，但是并不保存数据，它只负责处理流经它的数据。 gulp 中接触的流就是 transform 流。</p>
<p>###duplex流</p>
<p>Duplex 流是一个可读也可写的流，就好像一个电话，可以接收也可以发送语音。一个rpc交换是一个duplex流的最好的例子。如果你看到过下面这样的代码：</p>
<p>a.pipe(b).pipe(a)<br>那么你需要处理的就是一个duplex流对象。</p>

	
	</div>
  <a type="button" href="/2015/10/23/node-stream/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/js中的编码转换/" >js中的编码转换</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>#js 的码</p>
<p>#1. btoa, atob</p>
<p>WindowBase64.btoa()</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> encodedData = <span class="built_in">window</span>.btoa(stringToEncode);</div></pre></td></tr></table></figure>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> encodedData = <span class="built_in">window</span>.btoa(<span class="string">"Hello, world"</span>); <span class="comment">// encode a string</span></div><div class="line"><span class="keyword">var</span> decodedData = <span class="built_in">window</span>.atob(encodedData); <span class="comment">// decode the string</span></div></pre></td></tr></table></figure>
<p>Notes<br>You can use this method to encode data which may otherwise cause communication problems, transmit it, then use the window.atob() method to decode the data again. For example, you can encode control characters such as ASCII values 0 through 31.</p>
<p>btoa() is also available to XPCOM components implemented in JavaScript, even though window is not the global object in components.</p>
<p>Unicode Strings<br>In most browsers, calling window.btoa() on a Unicode string will cause a Character Out Of Range exception.</p>
<p>To avoid this, consider this pattern, noted by Johan Sundström:</p>
<pre><code>function utf8_to_b64(str) {
    return window.btoa(unescape(encodeURIComponent(str)));
}

function b64_to_utf8(str) {
    return decodeURIComponent(escape(window.atob(str)));
}
</code></pre><p>// Usage:<br>utf8_to_b64(‘✓ à la mode’); // JTI1dTI3MTMlMjUyMCUyNUUwJTI1MjBsYSUyNTIwbW9kZQ==<br>b64_to_utf8(‘JTI1dTI3MTMlMjUyMCUyNUUwJTI1MjBsYSUyNTIwbW9kZQ==’); // “✓ à la mode”</p>
<p>utf8_to_b64(‘I \u2661 Unicode!’); // SSUyNTIwJTI1dTI2NjElMjUyMFVuaWNvZGUlMjUyMQ==<br>b64_to_utf8(‘SSUyNTIwJTI1dTI2NjElMjUyMFVuaWNvZGUlMjUyMQ==’); // “I ♡ Unicode!”<br>A better, more faithful and less expensive solution is to convert the DOMString to a UTF-8 encoded string passing for typed arrays. In order to do this, please, read this paragraph.</p>
<p>##2. escape</p>
<p>##. encodeURIComponent</p>

	
	</div>
  <a type="button" href="/2015/10/23/js中的编码转换/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/Genymotion-使用-charles-代理/" >Genymotion 使用 charles 代理</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>在 Genymotion 模拟器中：</p>
<ol>
<li>Settings -&gt; Wifi -&gt; Press and hold your active network</li>
<li>Select “Modify Network”</li>
<li>Select “Show Advanced Options”</li>
<li>Select “Proxy Settings -&gt; Manual”</li>
<li>Set your Proxy to: 10.0.3.2 (Genymotion’s special code for the local workstation)</li>
<li>Set your Port to: 8888</li>
<li>ok</li>
</ol>

	
	</div>
  <a type="button" href="/2015/10/23/Genymotion-使用-charles-代理/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/视口/" >视口</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##1. 像素<br>一个像素就是计算机屏幕能显示一种特定颜色的最小区域， 屏幕上的像素越多，同一时间你可以看到的就越多。 当设备尺寸相同但像素变得更密集时，屏幕上能显示的画面的过渡更细致。<br>实际上， 有以下两种像素：</p>
<ol>
<li>设备像素： 设备屏幕的物理像素，任何设备的物理像素的数量都是固定的。</li>
<li>css 像素：为 web 开发者创造的，在 css/js 中使用的一个抽象层。</li>
</ol>
<p>加入设置一个元素 width: 100px， 是设置元素跨越了 200 个 css 元素。 200个 css 像素相当于多少个物理像素取决于屏幕特性和用户的缩放行为。放大的越大，一个 css 像素覆盖的物理像素的就越多。</p>
<p>##2. 页面缩放<br>假设一个桌面端浏览器的宽度是 1024px， 这意味着桌面上有 1024个 css 像素。</p>
<p>##3. 设备像素比<br>javascript 中有一个属性 <code>window.devicePixelRatio</code>, css 中也有 <code>device-pixel-ratio</code> 属性，称为设备像素比(Device Pixel Ratio, DPR),<br>设备像素和理想视口的比。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meat <span class="built_in">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width"</span>&gt;</div></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2015/10/23/视口/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-10-23 </div>
			<div class="article-title"><a href="/2015/10/23/add-draft2/" >add draft2</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		
	
	</div>
  <a type="button" href="/2015/10/23/add-draft2/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/4/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/6/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			 

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Sports/Baseball/">Baseball<span>2</span></a></li>
		
			<li><a href="/categories/Sports/">Sports<span>2</span></a></li>
		
			<li><a href="/categories/bom/">bom<span>1</span></a></li>
		
			<li><a href="/categories/collection/">collection<span>1</span></a></li>
		
			<li><a href="/categories/css/">css<span>1</span></a></li>
		
			<li><a href="/categories/http/">http<span>1</span></a></li>
		
			<li><a href="/categories/javascript-template/">javascript template<span>1</span></a></li>
		
			<li><a href="/categories/javascript-test/">javascript test<span>1</span></a></li>
		
			<li><a href="/categories/jquery/">jquery<span>1</span></a></li>
		
			<li><a href="/categories/library/">library<span>2</span></a></li>
		
			<li><a href="/categories/note/">note<span>1</span></a></li>
		
			<li><a href="/categories/note-vim/">note vim<span>2</span></a></li>
		
			<li><a href="/categories/tool/">tool<span>3</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/default/">default<span>1</span></a></li>
		
			<li><a href="/tags/jquery/">jquery<span>3</span></a></li>
		
			<li><a href="/tags/javascript-template/">javascript template<span>1</span></a></li>
		
			<li><a href="/tags/html/">html<span>2</span></a></li>
		
			<li><a href="/tags/tools/">tools<span>2</span></a></li>
		
			<li><a href="/tags/Shocking/">Shocking<span>2</span></a></li>
		
			<li><a href="/tags/polymer/">polymer<span>3</span></a></li>
		
			<li><a href="/tags/hg/">hg<span>1</span></a></li>
		
			<li><a href="/tags/framework/">framework<span>1</span></a></li>
		
			<li><a href="/tags/Injury/">Injury<span>2</span></a></li>
		
			<li><a href="/tags/http/">http<span>2</span></a></li>
		
			<li><a href="/tags/webponent/">webponent<span>1</span></a></li>
		
			<li><a href="/tags/build/">build<span>2</span></a></li>
		
			<li><a href="/tags/database-linux/">database linux<span>1</span></a></li>
		
			<li><a href="/tags/javascript-regexp/">javascript regexp<span>1</span></a></li>
		
			<li><a href="/tags/library/">library<span>3</span></a></li>
		
			<li><a href="/tags/browser/">browser<span>3</span></a></li>
		
			<li><a href="/tags/html-优化/">html 优化<span>1</span></a></li>
		
			<li><a href="/tags/seajs/">seajs<span>1</span></a></li>
		
			<li><a href="/tags/dom-javascript/">dom,javascript<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>39</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2017/02/01/2012-08-03-linux同步标准时间/" ><i class="fa fa-file-o"></i>linux同步标准时间</a>
      </li>
    
      <li>
        <a href="/2017/02/01/设计模式简介/" ><i class="fa fa-file-o"></i></a>
      </li>
    
      <li>
        <a href="/2017/02/01/2012-08-03-页面性能的几个评测点/" ><i class="fa fa-file-o"></i>页面性能的几个评测点</a>
      </li>
    
      <li>
        <a href="/2017/02/01/脚本的第一行/" ><i class="fa fa-file-o"></i></a>
      </li>
    
      <li>
        <a href="/2017/02/01/消除函数的术语歧义/" ><i class="fa fa-file-o"></i></a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/chenyakun" title="My Github repository." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 yakun.cyk
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<!-- <script src="/js/search.js"></script>  -->

<!-- 
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>
 -->

<!-- 
   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>
 -->

<div class="cb-search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
        opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">

    <input type="text" class="cb-search-content" id="cb-search-content" style="position: fixed; top: 60px" placeholder="文章标题 日期 标签" />

    <div style="position: fixed; top: 16px; right: 16px;">
        <img src="/search/img/cb-close.png"  id="cb-close-btn"/>
    </div>
</div>

<!-- <div style="position: fixed; right: 16px; bottom: 20px;">
    <img src="/search/img/cb-search.png"  id="cb-search-btn"  title="双击ctrl试一下"/>
</div> -->

<link rel="stylesheet" href="/search/css/cb-search.css">
<script src="/search/js/bootstrap3-typeahead.min.js"></script>
<script src="/search/js/cb-search.js"></script>

</body>
   </html>
