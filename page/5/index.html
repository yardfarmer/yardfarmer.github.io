<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | output stream</title>
  <meta name="author" content="yakun.cyk">
  
  <meta name="description" content="主要内容可能关于 web 技术，感慨心得...">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="output stream"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	    <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
	  <a class="navbar-brand" href="/">output stream</a>
      <div class="collapse navbar-collapse nav-menu">
		    <ul class="nav navbar-nav">
    		  
    		  <li>
    			 <a href="/demos" title="Demos.">
            <i class="fa fa-flask"></i>Demos
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/archives" title="All the articles.">
            <i class="fa fa-archive"></i>归档
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/about" title="About me.">
            <i class="fa fa-user"></i>关于我
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/#" title="Search Posts.">
            <i class="fa fa-search"></i>搜索
    			 </a>
    		  </li>
    		  
    		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <!--
        <i class="fa fa-heart"></i> 
      -->
      
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-02-12 </div>
			<div class="article-title"><a href="/2015/02/12/2015-02-11-d3/" >D3.js 制作图表</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>D3.js 为数据可视化而生，是一个适于生成互动图形的JavaScript函数库,可用于制作图表展示数据，d3完全开源，方便制作完全满足项目业务逻辑的需求，而不受现有图表库的种种限制。</p>
<h2 id="操作网页元素"><a href="#操作网页元素" class="headerlink" title="操作网页元素"></a>操作网页元素</h2><p>D3提供了一系列操作网页元素的方法，很类似jQuery，也是先选中某个元素（select方法），然后对其进行某种操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> body = d3.select(<span class="string">"body"</span>);</div><div class="line"><span class="keyword">var</span> div = body.append(<span class="string">"div"</span>);</div><div class="line">div.html(<span class="string">"Hello, world!"</span>);</div></pre></td></tr></table></figure>
<p>select方法用于选中一个元素，而selectAll方法用于选中一组元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> section = d3.selectAll(<span class="string">"section"</span>);</div><div class="line"><span class="keyword">var</span> div = section.append(<span class="string">"div"</span>);</div><div class="line">div.html(<span class="string">"Hello, world!"</span>);</div></pre></td></tr></table></figure>
<p>d3采用类似 jQuery 的链式操作方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">d3.select(<span class="string">"body"</span>)</div><div class="line">    .style(<span class="string">"color"</span>, <span class="string">"black"</span>)</div><div class="line">    .style(<span class="string">"background-color"</span>, <span class="string">"white"</span>);</div></pre></td></tr></table></figure>
<p>需要注意的是append方法返回一个新对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">d3.selectAll(<span class="string">"section"</span>)</div><div class="line">  .attr(<span class="string">"class"</span>, <span class="string">"special"</span>)</div><div class="line">  .append(<span class="string">"div"</span>)</div><div class="line">  .html(<span class="string">"Hello, world!"</span>);</div></pre></td></tr></table></figure>
<h2 id="生成svg元素"><a href="#生成svg元素" class="headerlink" title="生成svg元素"></a>生成svg元素</h2><p>D3作图需要svg元素，可以用JavaScript代码动态生成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> v = d3.select(<span class="string">"#graph"</span>)</div><div class="line">            .append(<span class="string">"svg"</span>);</div><div class="line"></div><div class="line">v.attr(<span class="string">"width"</span>, <span class="number">900</span>).attr(<span class="string">"height"</span>, <span class="number">400</span>);</div></pre></td></tr></table></figure>
<h2 id="生成图形"><a href="#生成图形" class="headerlink" title="生成图形"></a>生成图形</h2><h3 id="选中对象集"><a href="#选中对象集" class="headerlink" title="选中对象集"></a>选中对象集</h3><p>selectAll方法不仅可以选中现有的网页元素，还可以选中当前尚不存在的网页元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">d3.select(<span class="string">".chart"</span>)</div><div class="line">  .selectAll(<span class="string">"div"</span>);</div></pre></td></tr></table></figure>
<p>上面代码表示，selectAll方法选中了.chart元素下面所有现有和将来可能出现的div元素。</p>
<h3 id="绑定数据"><a href="#绑定数据" class="headerlink" title="绑定数据"></a>绑定数据</h3><p>data方法用于对选中的结果集绑定数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> data = [<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">12</span>];</div><div class="line"></div><div class="line">d3.select(<span class="string">".chart"</span>)</div><div class="line">  .selectAll(<span class="string">"div"</span>)</div><div class="line">  .data(data)</div><div class="line">  .enter().append(<span class="string">"div"</span>)</div><div class="line">  .style(<span class="string">"width"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d * <span class="number">10</span> + <span class="string">"px"</span>; &#125;)</div><div class="line">  .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d; &#125;);</div></pre></td></tr></table></figure>
<p>上面代码中，enter方法和append方法表示由于此时div元素还不存在，必须根据数据的个数将它们创造出来。style方法和text方法的参数是函数，表示函数的运行结果就是设置网页元素的值。</p>
<p>上面代码的运行结果是生成一个条状图，但是没有对条状图的长度进行控制，下面采用scale.linear方法对数据长度进行设置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> data = [<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">12</span>];</div><div class="line"></div><div class="line"><span class="keyword">var</span> x = d3.scale.linear()</div><div class="line">    .domain([<span class="number">0</span>, d3.max(data)])</div><div class="line">    .range([<span class="number">0</span>, <span class="number">420</span>]);</div><div class="line"></div><div class="line">d3.select(<span class="string">".chart"</span>)</div><div class="line">  .selectAll(<span class="string">"div"</span>)</div><div class="line">  .data(data)</div><div class="line">  .enter().append(<span class="string">"div"</span>)</div><div class="line">  .style(<span class="string">"width"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d) + <span class="string">"px"</span>; &#125;)</div><div class="line">  .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d; &#125;);</div></pre></td></tr></table></figure>
<h2 id="操作SVG图形"><a href="#操作SVG图形" class="headerlink" title="操作SVG图形"></a>操作SVG图形</h2><p>使用SVG图形生成条形图，首先是选中矢量图格式，然后每个数据值生成一个g元素（group），再在每个g元素内部生成一个rect元素和text元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> width = <span class="number">840</span>,</div><div class="line">    barHeight = <span class="number">20</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> x = d3.scale.linear()</div><div class="line">    .domain([<span class="number">0</span>, d3.max(dataArray)])</div><div class="line">    .range([<span class="number">0</span>, width]);</div><div class="line"></div><div class="line"><span class="keyword">var</span> chart = d3.select(<span class="string">".bar-chart-svg"</span>)</div><div class="line">    .attr(<span class="string">"width"</span>, width)</div><div class="line">    .attr(<span class="string">"height"</span>, barHeight * dataArray.length);</div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = chart.selectAll(<span class="string">"g"</span>)</div><div class="line">    .data(dataArray)</div><div class="line">  .enter().append(<span class="string">"g"</span>)</div><div class="line">    .attr(<span class="string">"transform"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d, i</span>) </span>&#123; <span class="keyword">return</span> <span class="string">"translate(0,"</span> + i * barHeight + <span class="string">")"</span>; &#125;);</div><div class="line"></div><div class="line">bar.append(<span class="string">"rect"</span>)</div><div class="line">    .attr(<span class="string">"width"</span>, x)</div><div class="line">    .attr(<span class="string">"height"</span>, barHeight - <span class="number">1</span>);</div><div class="line"></div><div class="line">bar.append(<span class="string">"text"</span>)</div><div class="line">    .attr(<span class="string">"x"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> x(d) - <span class="number">3</span>; &#125;)</div><div class="line">    .attr(<span class="string">"y"</span>, barHeight / <span class="number">2</span>)</div><div class="line">    .attr(<span class="string">"dy"</span>, <span class="string">".35em"</span>)</div><div class="line">    .text(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d; &#125;);</div></pre></td></tr></table></figure>
<h2 id="加载XML文件"><a href="#加载XML文件" class="headerlink" title="加载XML文件"></a>加载XML文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">d3.xml(<span class="string">'example'</span>, <span class="string">'image/svg+xml'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, data</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'加载SVG文件出错！'</span>, error);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 处理SVG文件</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li>Dana Silver, <a href="http://danasilver.org/2013/12/31/d3-github-language-stats/" target="_blank" rel="external">The d3.js Bar Chart Tutorials with Github Data</a></li>
</ul>

	
	</div>
  <a type="button" href="/2015/02/12/2015-02-11-d3/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-01-18 </div>
			<div class="article-title"><a href="/2015/01/18/2015-01-28-seajs/" >seajs 使用记录</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>#require 书写约定</p>
<p>使用 Sea.js 书写模块代码时，需要遵循一些简单规则。</p>
<ol>
<li>正确拼写</li>
</ol>
<p>模块 factory 构造方法的第一个参数 必须 命名为 require 。</p>
<pre><code>// 错误！
define(function(req) {
  // ...
});

// 正确！
define(function(require) {
  // ...l
});
</code></pre><ol>
<li>不要修改</li>
</ol>
<p>不要重命名 require 函数，或在任何作用域中给 require 重新赋值。</p>
<pre><code>// 错误 - 重命名 &quot;require&quot;！
var req = require, mod = req(&quot;./mod&quot;);

// 错误 - 重定义 &quot;require&quot;!
require = function() {};

// 错误 - 重定义 &quot;require&quot; 为函数参数！
function F(require) {}

// 错误 - 在内嵌作用域内重定义了 &quot;require&quot;！
function F() {
  var require = function() {};
}
</code></pre><ol>
<li>使用直接量</li>
</ol>
<p>require 的参数值 必须 是字符串直接量。</p>
<pre><code>// 错误！
require(myModule);

// 错误！
require(&quot;my-&quot; + &quot;module&quot;);

// 错误！
require(&quot;MY-MODULE&quot;.toLowerCase());

// 正确！
require(&quot;my-module&quot;);
</code></pre><p>在书写模块代码时，必须遵循这些规则。其实只要把 require 看做是语法<code>关键字</code>。</p>
<blockquote>
<p>之所以必须使用 require， 是因为 seajs 内部采用正则匹配的方式找到 require，然后加载依赖模块。</p>
</blockquote>
<h2 id="关于动态依赖"><a href="#关于动态依赖" class="headerlink" title="关于动态依赖"></a>关于动态依赖</h2><p>有时会希望可以使用 require 来进行条件加载：</p>
<pre><code>if (todayIsWeekend)
  require(&quot;play&quot;);
else
  require(&quot;work&quot;);
</code></pre><p>但请牢记，从静态分析的角度来看，这个模块同时依赖 play 和 work 两个模块，加载器会把这两个模块文件都下载下来。 <strong>require 不是同步加载，而是异步加载，并且是预加载</strong> 这种情况下，推荐使用 require.async 来进行条件加载。</p>

	
	</div>
  <a type="button" href="/2015/01/18/2015-01-28-seajs/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-01-16 </div>
			<div class="article-title"><a href="/2015/01/16/2015-01-16-hg-remote-push-hook/" >使用hg推送后执行编译</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="hg-hook"><a href="#hg-hook" class="headerlink" title="hg hook"></a>hg hook</h2><p>大多数的版本管理工具都具有<code>钩子</code>功能，这里记录下开发团队内部工具<a href="https://github.com/chenyakun/sluggard" title="github repo" target="_blank" rel="external">sluggard</a>时,遇到的关于<a href="http://www.selenic.com/mercurial/hgrc.5.html#hooks" target="_blank" rel="external">hg hook</a>的使用。</p>
<p>在被推送端, <code>.hg/hgrc</code>下配置</p>
<pre><code>[ui]
username = hg_be_pushed
verbose = True

[hooks]
commit = /path/to/commithook
incoming = /path/to/incominghook    # 每个 commit 执行一次
changegroup= /path/to/changegroup   # 每次被 push 执行一次

[web]
push_ssl = No    # 放开ssl限制
allow_push = *   # 运行推送
</code></pre><p>需要说明的是，被push端需要开启<strong>web服务</strong>,才能接收<code>push</code></p>
<pre><code>hg serve -p port
</code></pre><p>推送端，<code>.hg/hgrc</code>配置如下</p>
<pre><code>[ui]
username = hg_to_push

[paths]
default = http://localhost:8002/       # 用于pulling
default-push = http://localhost:8002/  # 被推送端的 web 服务地址
</code></pre><p>当推送遇到错误时，可尝试</p>
<pre><code>hg push -f
</code></pre><p>当更新遇到错误时，可尝试</p>
<pre><code>hg update --check
</code></pre>
	
	</div>
  <a type="button" href="/2015/01/16/2015-01-16-hg-remote-push-hook/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-01-12 </div>
			<div class="article-title"><a href="/2015/01/12/2015-03-22-underscore接口理解/" >Underscore.js</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##简介<br><a href="http://underscorejs.org/" target="_blank" rel="external">Underscore.js</a>是一个灵巧的工具库。它提供了几十种函数式编程的方法，大大方便了JavaScript的编程。MVC框架Backbone.js就将这个库作为自己的工具库。除了可以在浏览器环境使用，Underscore.js还可以用于Node.js。<br>Underscore.js定义了一个下划线（_）对象，函数库的所有方法都属于这个对象。这些方法大致上可以分成：集合（collection）、数组（array）、函数（function）、对象（object）和工具（utility）五大类。 </p>
<p>##接口示例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> &gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span> &gt;</span><span class="tag">&lt;/<span class="name">title</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../underscore-reading.js"</span> &gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="name">script</span> &gt;</span></span></span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span> &gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"underscore_button"</span>&gt;</span>test button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"throttle_button"</span>&gt;</span>throttle button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"debounce_button"</span>&gt;</span>debounce button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  [].forEach(function(value, key, list) &#123; &#125;)</div><div class="line">     */</div><div class="line">    <span class="keyword">var</span> testData = [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>];</div><div class="line"></div><div class="line">    _.each(testData, <span class="function"><span class="keyword">function</span>(<span class="params">value, key, list</span>) </span>&#123;</div><div class="line">    <span class="comment">//  console.log(arguments);</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// map 映射, 返回新的数组</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> eighted = _.map(testData, <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">      <span class="keyword">return</span> num * <span class="number">8</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'mapped'</span>, eighted, testData);</div><div class="line"></div><div class="line">    <span class="comment">// 数组拷贝</span></div><div class="line">    <span class="keyword">var</span> cpData = testData.slice(<span class="number">0</span>);</div><div class="line">    cpData.pop();</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'copy'</span>, testData, cpData)</div><div class="line"></div><div class="line">    <span class="comment">//_.reduce(list, iteratee(memo, value, key, list), [memo], context);</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> rst = _.reduce(testData, <span class="function"><span class="keyword">function</span>(<span class="params">memo, value, key, list</span>) </span>&#123;</div><div class="line">       <span class="comment">// console.log(arguments);</span></div><div class="line">        <span class="keyword">return</span> memo + value;</div><div class="line">    &#125;);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'fib'</span>,rst);</div><div class="line"></div><div class="line">    <span class="comment">// _.find(list, predicate, [context])</span></div><div class="line">    <span class="keyword">var</span> back  = _.find(testData, <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> num &gt; <span class="number">5</span>;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'back'</span>, back);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> objData = [</div><div class="line">        &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">1</span>&#125;,</div><div class="line">        &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">2</span>&#125;,</div><div class="line">        &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>, <span class="attr">c</span>:<span class="number">3</span>&#125;</div><div class="line">    ];</div><div class="line"></div><div class="line">    <span class="keyword">var</span> t = _.where(objData, &#123;<span class="attr">c</span>:<span class="number">1</span>&#125;);</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"where"</span>, t);</div><div class="line"></div><div class="line">    <span class="comment">// 从 `map` 中按名取值, pluck 快而猛的拉，从...中抽拔</span></div><div class="line">    <span class="keyword">var</span> stooges = [&#123;<span class="attr">name</span>: <span class="string">'moe'</span>, <span class="attr">age</span>: <span class="number">40</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">'larry'</span>, <span class="attr">age</span>: <span class="number">50</span>&#125;,</div><div class="line">                   &#123;<span class="attr">name</span>: <span class="string">'curly'</span>, <span class="attr">age</span>: <span class="number">60</span>&#125;];</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pluck"</span>, _.pluck(stooges, <span class="string">'name'</span>));</div><div class="line"></div><div class="line">    <span class="comment">// 返回除去后 n 位的部分</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"initial,"</span>, _.initial([<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], <span class="number">2</span>));</div><div class="line"></div><div class="line">    <span class="comment">// 与 initial 相对</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"rest"</span>, _.rest([<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>], <span class="number">2</span>));</div><div class="line"></div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params">greeting</span>) </span>&#123;<span class="keyword">return</span> greeting + <span class="string">":"</span> + <span class="keyword">this</span>.name &#125;;</div><div class="line">    func = _.bind(func, &#123;<span class="attr">name</span>: <span class="string">'im obj'</span>&#125;, <span class="string">'[this is arguments]'</span>);</div><div class="line">    <span class="comment">// 已经被过河拆桥</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'bind 返回新的 function '</span>, func());</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> buttonView = &#123;</div><div class="line">        <span class="attr">label</span>  : <span class="string">'underscore'</span>,</div><div class="line">        <span class="comment">// 通过 e.target  可以得到目标元素， this 真的是意义不到</span></div><div class="line">        <span class="comment">// be invoked with a fairly useless this.</span></div><div class="line">        onClick: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'bindAll'</span>, <span class="keyword">this</span>.label, e.target) &#125;,</div><div class="line">        <span class="attr">onHover</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">'hovering: '</span> + <span class="keyword">this</span>.label); &#125;</div><div class="line">    &#125;;</div><div class="line">    _.bindAll(buttonView, <span class="string">'onClick'</span>, <span class="string">'onHover'</span>);</div><div class="line">    <span class="comment">// When the button is clicked, this.label will have the correct value.</span></div><div class="line"></div><div class="line">    underscore_button.addEventListener(<span class="string">'click'</span>, buttonView.onClick, <span class="literal">false</span>);</div><div class="line">    underscore_button.addEventListener(<span class="string">'hover'</span>, buttonView.onHover, <span class="literal">false</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">"partial"</span> ,a ,b)&#125;;</div><div class="line"></div><div class="line">    <span class="comment">// 这个 arguments* 这里的参数在包裹的内部函数的最前面</span></div><div class="line">    <span class="comment">// _.partial(function, *arguments)</span></div><div class="line">    add5 = _.partial(add, <span class="number">5</span>, <span class="number">4</span>); <span class="comment">//</span></div><div class="line">    add5(<span class="number">1</span>,<span class="number">2</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 在递归中会缓存方法的计算结果，达到类似 map 缓存的效果</span></div><div class="line">    <span class="keyword">var</span> fibonacci = _.memoize(<span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n: fibonacci( n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"memoize"</span>, fibonacci(<span class="number">100</span>));</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> n &lt; <span class="number">2</span> ? n: fibonacci( n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"fibonacci"</span>, fibonacci(<span class="number">100</span>));</div><div class="line"></div><div class="line">    <span class="keyword">var</span> log = _.bind(<span class="built_in">console</span>.log, <span class="built_in">console</span>);</div><div class="line">    _.delay(log, <span class="number">1000</span>, <span class="string">'delay'</span>,<span class="string">'log latter'</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> throttled = _.throttle(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        log(<span class="string">'throttle'</span>);</div><div class="line">    &#125;, <span class="number">3000</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</div><div class="line">        throttled();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 延时按钮, 处理频繁点击,加上限流阀</span></div><div class="line">    throttle_button.addEventListener(<span class="string">'click'</span>, throttled, <span class="literal">false</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// 每次执行间隔指定时间, 在间隔时间内对方法调用不再执行，</span></div><div class="line">    <span class="comment">// 但是会把间隔时间的起点设置为此次对方法调用的时间</span></div><div class="line">    <span class="comment">// 举例来说：下面这个情况， 每个2999 毫秒 单击一次，</span></div><div class="line">    <span class="comment">// 不满足每个3000秒的时间间隔, 故回调不执行</span></div><div class="line">    <span class="comment">// 即使每隔 2999 毫秒店家1000次，也只会在最后一次单击 3000ms 后，</span></div><div class="line">    <span class="comment">// 才能正常执行回调</span></div><div class="line">    <span class="comment">// 所以 debounce 适合用于 resize, 在窗口不再改变后执行就好了, 在</span></div><div class="line">    <span class="comment">// 移动中执行也没有意义</span></div><div class="line">    <span class="comment">// 另外适合输入框取值, 如果输入框一直在 change, 拿到值也没用, 所以在不变化执行就可以了。</span></div><div class="line">    <span class="keyword">var</span> slowClick = _.debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        log(<span class="string">"click"</span>, <span class="string">"_debounce"</span>);</div><div class="line">    &#125;, <span class="number">3000</span>);</div><div class="line"></div><div class="line">    debounce_button.addEventListener(<span class="string">'click'</span>, slowClick, <span class="literal">false</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// after:  在已经被掉了 指定次数 后，才执行</span></div><div class="line">    <span class="comment">// api 示例说适用于 异步处理, 在所有任务都完成时才执行。</span></div><div class="line">    <span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;log(<span class="string">'after'</span>)&#125;;</div><div class="line">    <span class="keyword">var</span> renderJob = _.after(<span class="number">5</span>, render);</div><div class="line">    _.each([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>], <span class="function"><span class="keyword">function</span>(<span class="params">job</span>) </span>&#123;</div><div class="line">        renderJob();</div><div class="line">    &#125;)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// wrapper 注入/ AOP 切面编程</span></div><div class="line">    <span class="keyword">var</span> hello = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123; <span class="keyword">return</span> <span class="string">"hello: "</span> + name; &#125;;</div><div class="line">    hello = _.wrap(hello, <span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"before, "</span> + func(<span class="string">"moe"</span>) + <span class="string">", after"</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"wrap"</span>, hello());</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// compose, 组合模式/  像极管道 大管子</span></div><div class="line">    <span class="keyword">var</span> greet    = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123; <span class="keyword">return</span> <span class="string">"hi: "</span> + name; &#125;;</div><div class="line">    <span class="keyword">var</span> exclaim  = <span class="function"><span class="keyword">function</span>(<span class="params">statement</span>)</span>&#123; <span class="keyword">return</span> statement.toUpperCase() + <span class="string">"!"</span>; &#125;;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Caution!</div><div class="line">     * _.compose(f, g, h);</div><div class="line">     * 数据流为  f() &lt;- g() &lt;- h();</div><div class="line">     * f(), g(), and h() produces f(g(h())).</div><div class="line">     */</div><div class="line">    <span class="keyword">var</span> welcome = _.compose(log, greet, exclaim);</div><div class="line">    <span class="keyword">var</span> moe = welcome(<span class="string">'moe'</span>);</div><div class="line">    <span class="comment">//log('compose:' ,moe);</span></div><div class="line"></div><div class="line">    <span class="comment">// 对象 extend</span></div><div class="line">    <span class="keyword">var</span> big = _.extend(&#123;<span class="attr">x</span>: <span class="number">1</span>&#125;, &#123;<span class="attr">y</span>: <span class="number">2</span>&#125;);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'extend'</span>, big);</div><div class="line"></div><div class="line">    <span class="comment">// 给对象设置默认参数, 只给设置对象原本不存在的参数</span></div><div class="line">    <span class="keyword">var</span> iceCream = &#123;<span class="attr">flavor</span>: <span class="string">"chocolate"</span>&#125;;</div><div class="line">    _.defaults(iceCream, &#123;<span class="attr">flavor</span>: <span class="string">"vanilla"</span>, <span class="attr">sprinkles</span>: <span class="string">"lots"</span>&#125;);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">var</span> tapData = _.chain(testData)</div><div class="line">            .filter(<span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> num &gt; <span class="number">5</span>;</div><div class="line">            &#125;)</div><div class="line">            .tap(log)</div><div class="line">            <span class="comment">// 多中间数据没有改变</span></div><div class="line">            .tap(<span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'tapped: '</span>, num); <span class="keyword">return</span> num * <span class="number">2</span>; &#125;)</div><div class="line">            .tap(log)</div><div class="line">            .map(<span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123; <span class="keyword">return</span> num * num; &#125;)</div><div class="line">            .value();</div><div class="line">    log(<span class="string">"tapData"</span>, tapData);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// 扩展 underscore</span></div><div class="line">    <span class="comment">// underscore 扩展接口, 方便实用</span></div><div class="line">    _.mixin(&#123;</div><div class="line">        <span class="attr">hello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"mixin: "</span>, <span class="string">"have a good time!"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;)</div><div class="line">    _.hello();</div><div class="line">    _(<span class="string">""</span>).hello();</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// &lt;%= someThing %&gt;</span></div><div class="line">    <span class="comment">// 模板的使用</span></div><div class="line">    <span class="keyword">var</span> compiled = _.template(<span class="string">"hello: &lt;%= name %&gt;"</span>);</div><div class="line">    log(compiled(&#123; <span class="attr">name</span>: <span class="string">"moe"</span> &#125;));</div><div class="line"></div><div class="line">    <span class="keyword">var</span> lyrics = [</div><div class="line">        &#123;<span class="attr">line</span>: <span class="number">1</span>, <span class="attr">words</span>: <span class="string">"I'm a lumberjack and I'm okay"</span>&#125;,</div><div class="line">        &#123;<span class="attr">line</span>: <span class="number">2</span>, <span class="attr">words</span>: <span class="string">"I sleep all night and I work all day"</span>&#125;,</div><div class="line">        &#123;<span class="attr">line</span>: <span class="number">3</span>, <span class="attr">words</span>: <span class="string">"He's a lumberjack and he's okay"</span>&#125;,</div><div class="line">        &#123;<span class="attr">line</span>: <span class="number">4</span>, <span class="attr">words</span>: <span class="string">"He sleeps all night and he works all day"</span>&#125;</div><div class="line">    ];</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// 我没有任何天分， 我只有梦的天真</span></div><div class="line">    <span class="comment">// 输掉目标， 不能输掉人生</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * _.map([1, 2, 3], function(n)&#123; return n * 2; &#125;);</div><div class="line">     * _([1, 2, 3]).map(function(n)&#123; return n * 2; &#125;);</div><div class="line">     * 这其实是 underscore 的两种使用方式，回调式的和链式的</div><div class="line">     *</div><div class="line">     *  Returns a wrapped object.</div><div class="line">     *  Calling methods on this object will continue to return wrapped objects</div><div class="line">     *  until value is called.</div><div class="line">     *</div><div class="line">     *  这里 wrapped object 其实是 类似 jQ 对象的一个包裹后的对象,</div><div class="line">     *  本质就是挂载了 underscore 接口的 prototype</div><div class="line">     *  之所以挂载 prototype 是因为, 为了实现链式操作</div><div class="line">     */</div><div class="line"></div><div class="line">    <span class="keyword">var</span> chainData = _.chain(lyrics);</div><div class="line">    log(<span class="string">"chain, return a wrapped data:"</span>, chainData);</div><div class="line">    log(<span class="string">"chain, back to original data:"</span>, chainData.value());</div><div class="line"></div><div class="line">    <span class="keyword">var</span> d = chainData.map(<span class="function"><span class="keyword">function</span>(<span class="params"> line </span>) </span>&#123; <span class="keyword">return</span> line.words.split(<span class="string">' '</span>); &#125;)</div><div class="line">            .flatten()</div><div class="line">            <span class="comment">// reduce(data, function(memo, value, key , list))</span></div><div class="line">            .reduce(<span class="function"><span class="keyword">function</span>(<span class="params">counts, word</span>) </span>&#123; <span class="comment">// 实际参数为： memo, value, key, list</span></div><div class="line">                <span class="comment">// 通过 log, 可以很清楚的看清 reduce 是怎么回事。</span></div><div class="line">                <span class="comment">// log('inner reduce', counts, word);</span></div><div class="line"></div><div class="line">                counts[word] = (counts[word] || <span class="number">0</span>) + <span class="number">1</span>;</div><div class="line">                <span class="keyword">return</span> counts;</div><div class="line">            &#125;, &#123;&#125;) <span class="comment">// 这里的 `&#123;&#125;` 作为 前面 `iteratee` 回调参数中 memo 的初始值。</span></div><div class="line">            .value();</div><div class="line">    log(<span class="string">'chain compute'</span>, d);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span> &gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span> &gt;</span></div></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2015/01/12/2015-03-22-underscore接口理解/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-01-11 </div>
			<div class="article-title"><a href="/2015/01/11/2015-03-22-web-animations/" >web-animations</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>Web Animations defines APIs for synchronizing several of the web’s animation models with complex, scriptable animations.</p>
</blockquote>
<p>在 Web 平台上有四种技术可实现动画：CSS Transitions, CSS Animations, SVG Animations / SMIL, and requestAnimationFrame().<br>但是 </p>
<ul>
<li>CSS Transitions / CSS Animations 表现能力不足,无法并行运行，不能用 script 控制.</li>
<li>SVG Animations are  有表现力，但是编写复杂， can’t be applied to HTML content.</li>
<li>requestAnimationFrame() is not a declarative approach, 运行在主线程，主线程忙时，会卡顿</li>
</ul>
<p>于是，w3c 搞出了替代品</p>
<p>Basic usage<br>Here’s a simple example of an animation that scales and changes the opacity of a <div> over 0.5 seconds. The animation alternates producing a pulsing effect.</div></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pulse"</span> <span class="attr">style</span>=<span class="string">"width:150px;"</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">var</span> elem = <span class="built_in">document</span>.querySelector(<span class="string">'.pulse'</span>);</div><div class="line">  <span class="keyword">var</span> player = <span class="built_in">document</span>.timeline.play(<span class="keyword">new</span> Animation(elem, [</div><div class="line">      &#123;<span class="attr">opacity</span>: <span class="string">"0.5"</span>, <span class="attr">transform</span>: <span class="string">"scale(0.5)"</span>&#125;, </div><div class="line">      &#123;<span class="attr">opacity</span>: <span class="string">"1.0"</span>, <span class="attr">transform</span>: <span class="string">"scale(1)"</span>&#125;</div><div class="line">    ],</div><div class="line">    &#123;</div><div class="line">      <span class="attr">direction</span>: <span class="string">"alternate"</span>, <span class="attr">duration</span>: <span class="number">500</span>, <span class="attr">iterations</span>: <span class="literal">Infinity</span></div><div class="line">    &#125;));</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>还未正式发布，浏览器兼容不全，需要<code>刮腻子</code>.</p>

	
	</div>
  <a type="button" href="/2015/01/11/2015-03-22-web-animations/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2015-01-03 </div>
			<div class="article-title"><a href="/2015/01/03/2015-01-3-polymer/" >polymer的使用</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="结构搭建"><a href="#结构搭建" class="headerlink" title="结构搭建"></a>结构搭建</h2><h3 id="加载引用文件"><a href="#加载引用文件" class="headerlink" title="加载引用文件"></a>加载引用文件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span></span></div><div class="line">  <span class="attr">src</span>=<span class="string">"../components/platform/platform.js"</span>&gt;<span class="handlebars"><span class="xml"></span></span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span></span></div><div class="line">  <span class="attr">href</span>=<span class="string">"../components/font-roboto/roboto.html"</span>&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span></span></div><div class="line">  <span class="attr">href</span>=<span class="string">"../components/core-header-panel/core-header-panel.html"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span></span></div><div class="line">  <span class="attr">href</span>=<span class="string">"../components/core-toolbar/core-toolbar.html"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span></span></div><div class="line">  <span class="attr">href</span>=<span class="string">"../components/paper-tabs/paper-tabs.html"</span>&gt;</div><div class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div></pre></td></tr></table></figure>
<p>Polymer 使用 HTML imports 来加载 components. HTML imports 提供了依赖关系的管理，保证你的 elements 和它们的依赖都加载好了你再使用它们。</p>
<h3 id="预防-FOUC"><a href="#预防-FOUC" class="headerlink" title="预防 FOUC"></a>预防 FOUC</h3><p>在 custom elements 更新 之前可能显示错乱。 为了缓解 FOUC 问题, Polymer 提供了一个 polyfill 解决方案，配合 :unresolved 伪类 使用。 对于简单的 app，你可以为 body 添加 unresolved 属性。这将在页面初始化时隐藏页面直到所有的 elements 被更新才显示。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">unresolved</span>&gt;</span></div></pre></td></tr></table></figure>
<p>polymer-ready 触发前， Polymer 会执行以下的步骤：</p>
<ul>
<li>移除 elements 中 [unresolved] 属性</li>
<li>添加 [resolved] 属性</li>
<li>在 element 收到第一个  transitionend 时移除 [resolved]</li>
</ul>
<h3 id="声明式数据绑定"><a href="#声明式数据绑定" class="headerlink" title="声明式数据绑定"></a>声明式数据绑定</h3><p><code>胡子</code> 方式， mustache(有一款同名的模板引擎mustache.js)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">polymer-element</span> <span class="attr">name</span>=<span class="string">"name-tag"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">    This is <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123;owner&#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span>'s name-tag element.</div><div class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"></span></div><div class="line">    Polymer(<span class="string">'name-tag'</span>, &#123;</div><div class="line">      owner: <span class="string">'Daniel'</span></div><div class="line">    &#125;);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">polymer-element</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="自动化定位结点"><a href="#自动化定位结点" class="headerlink" title="自动化定位结点"></a>自动化定位结点</h3><p>Polymer 另一个给力的功能是自动化定位结点。一个 component 的 shadow DOM 中标有 id 特性的结点可以被自动引用在该 component 的 this.$ 散列表中。</p>
<p>注意：通过数据绑定动态创建的结点<em>无法</em>被添加到 this.$ 散列表中。该散列表只包含<em>静态</em>创建的 shadow DOM 结点 (即定义在 element 外部的模板中的结点)。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">polymer-element</span> <span class="attr">name</span>=<span class="string">"x-form"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"nameInput"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    Polymer(<span class="string">'x-form'</span>, &#123;</div><div class="line">      <span class="attr">logNameValue</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.$.nameInput.value);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">polymer-element</span>&gt;</span></div></pre></td></tr></table></figure>
<p>为了定位 element 的 shadow DOM 里的其它结点，你可以创建一个带有确定<code>id</code> 的容器 element，然后使用 querySelector 来获取子孙。举个例子，如果你的 element 的模板是下面这个样子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">if</span>=<span class="string">"&#123;&#123;some_condition&#125;&#125;"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"inner"</span>&gt;</span></div><div class="line">        该内容通过数据绑定被创建</div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></div></pre></td></tr></table></figure>
<p>你可以在容器内这样定位：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">this.$.container.querySelector('#inner');</div></pre></td></tr></table></figure>
<h3 id="触发自定义事件"><a href="#触发自定义事件" class="headerlink" title="触发自定义事件"></a>触发自定义事件</h3><p>Polymer core 提供了一个便捷的 fire() 方法传递自定义事件。实际上这是一个围绕标准的 node.dispatchEvent(new CustomEvent(…)) 包装出来的。当需要在一个微任务完成之后触发一个事件，请使用其异步的版本：asyncFire()。</p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span> <span class="attr">href</span>=<span class="string">"bower_components/polymer/polymer.html"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">polymer-element</span> <span class="attr">name</span>=<span class="string">"ouch-button"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">template</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">on-click</span>=<span class="string">"&#123;&#123;onClick&#125;&#125;"</span>&gt;</span>GO<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript"></span></div><div class="line">        Polymer(<span class="string">'ouch-button'</span>, &#123;</div><div class="line">            onClick: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</div><div class="line">				<span class="comment">// fire(inType, inDetail, inToNode)</span></div><div class="line">                <span class="keyword">this</span>.fire(<span class="string">'ouch'</span>, &#123;</div><div class="line">                    msg: <span class="string">'hahaha'</span></div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">polymer-element</span>&gt;</span></div></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bower_components/platform/platform.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"import"</span> <span class="attr">href</span>=<span class="string">"self_event_ref.html"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ouch-button</span>&gt;</span><span class="tag">&lt;/<span class="name">ouch-button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="built_in">document</span>.querySelector(<span class="string">'ouch-button'</span>).addEventListener(<span class="string">'ouch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(e.type, e.detail.msg);</div><div class="line">  &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>中文站 <a href="http://docs.polymerchina.org/docs/start/getting-the-code.html" target="_blank" rel="external">polymerchina</a></li>
</ul>

	
	</div>
  <a type="button" href="/2015/01/03/2015-01-3-polymer/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2014-12-30 </div>
			<div class="article-title"><a href="/2014/12/30/2013-12-30-http学习札记/" >http学习札记</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>HTTP 报文会像河水一样流动。不管是请求报文还是响应报文，所有报文都会向下游（downstream） 流动。所有报文的发送者都在接收者的上游。</p>
</blockquote>
<p>HTTP 报文是简单的格式化数据块。</p>
<p>报文块由三个部分组成：</p>
<pre><code>1. 对报文进行描述的起始行（start line）、 //  HTTP/1.0 200 OK
2. 包含属性的首部（header）块，{
    Content-type: text/plain
    Content-length: 100
}
3. 以及可选的、包含数据的主体（body）部分。(get 没有数据主体).
</code></pre><p>起始行和首部就是由行分隔的ASCII 文本。<br>每行都以一个由两个字符组成的行终止序列(CRLF, Carriage Return Line Feed)作为结束，其中包括一个回车符（ASCII 码13）和一个换行符（ASCII 码10）。</p>
<p>所有的HTTP 报文都可以分为两类： 请求报文（request message） 和响应报文（response message）。<code>本质就是 socket</code>。</p>
<ul>
<li>GET  从服务器获取一份文档        不包含主体</li>
<li>POST 向服务器发送需要处理的数据  包含主体 </li>
<li>HTTP 报文可以承载很多类型的数字数据：图片、视频、HTML 文档、软件应用程序、信用卡事务、电子邮件等。</li>
<li>POST 方法起初是用来向服务器输入数据的.</li>
</ul>
<p>重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么就提供一个替代的响应而不是资源的内容。<br>如果资源已被移动，可发送一个重定向状态码和一个可选的Location 首部来告知客户端资源已被移走，以及现在可以在哪里找到它。<br>浏览器就可以在不打扰使用者的情况下，透明地转入新的位置了。(地址栏直接跳转).</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">Remote</span> <span class="selector-tag">Address</span><span class="selector-pseudo">:128.121.66.211</span><span class="selector-pseudo">:80</span> (通过ip-&gt;dns查询来的)</div><div class="line"><span class="selector-tag">Request</span> <span class="selector-tag">URL</span><span class="selector-pseudo">:http</span>:<span class="comment">//www.joes-hardware.com/pet-products.txt</span></div><div class="line"><span class="selector-tag">Request</span> <span class="selector-tag">Method</span><span class="selector-pseudo">:GET</span></div><div class="line"><span class="selector-tag">Status</span> <span class="selector-tag">Code</span><span class="selector-pseudo">:301</span> <span class="selector-tag">Moved</span> <span class="selector-tag">Permanently</span></div><div class="line"><span class="selector-tag">RequestHeaders</span></div><div class="line"><span class="comment">// Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span></div><div class="line"><span class="comment">// Accept-Encoding:gzip,deflate,sdch</span></div><div class="line"><span class="comment">// Accept-Language:en,zh-CN;q=0.8,zh;q=0.6,ja;q=0.4</span></div><div class="line"><span class="comment">// Cache-Control:no-cache</span></div><div class="line"><span class="comment">// Connection:keep-alive</span></div><div class="line"><span class="comment">// DNT:1</span></div><div class="line"><span class="comment">// Host:www.joes-hardware.com</span></div><div class="line"><span class="comment">// Pragma:no-cache</span></div><div class="line"><span class="comment">// User-Agent:Mozilla/5.0</span></div><div class="line"></div><div class="line"><span class="selector-tag">ResonseHeaders</span></div><div class="line"><span class="comment">// Connection:Keep-Alive</span></div><div class="line"><span class="comment">// Content-Length:377</span></div><div class="line"><span class="comment">// Content-Type:text/html; charset=iso-8859-1</span></div><div class="line"><span class="comment">// Date:Wed, 01 Oct 2014 15:22:05 GMT</span></div><div class="line"><span class="comment">// Keep-Alive:timeout=15, max=98</span></div><div class="line"><span class="comment">// Location:http://www.gentle-grooming.com/</span></div><div class="line"><span class="comment">// Server:Apache/2.2.22 (Unix) DAV/2 FrontPage/5.0.2.2635 mod_ssl/2.2.22 OpenSSL/1.0.1h</span></div></pre></td></tr></table></figure>
<p>Location 用于跳转,在相应的 header 中直接提供了 Location 跳转的 url </p>
<p>301 Moved Permanently 在请求的URL 已被移除时使用。响应的Location 首部中应该包含资源现在所处的URL.</p>
<p>304 Not Modified 客户端可以通过所包含的请求首部，使其请求变成有条件的。<br>如果客户端发起了一个条件GET请求，而最近资源未被修改的话，就可以用这个状态码来说明资源未被修改。<br>带有这个状态码的响应不应该包含实体的主体部分。</p>
<p>标识为no-cache 的响应实际上是可以存储在本地缓存区中的。只是在与原始服务器进行新鲜度再验证之前，缓存不能将其提供给客户端使用。</p>
<p>HTTP/1.1 中提供Pragma: no-cache 首部是为了兼容于HTTP/1.0+。除了与只理解Pragma: no-cache 的HTTP/1.0 应用程序进行交互时，HTTP 1.1 应用程序都应该使用 Cache-Control: no-cache.</p>
<p>Cache-Control: max-age 首部表示的是从服务器将文档传来之时起，可以认为此文档处于新鲜状态的秒数.</p>
<p>服务器可以请求缓存不要缓存文档，或者将最大使用期设置为零，从而在每次访问的时候都进行刷新：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Cache</span><span class="params">-Control</span>: <span class="keyword">max</span><span class="params">-age</span>=<span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>http-equiv 元信息告诉浏览器如何去做，等效于设置了HTTP 报头。<br>这让你可以向浏览器传达一些原本由服务器告诉它的内容。当你不能控制服务器时，它特别有用。 (这句话很有内容，请求网页使，服务器在响应头里是可以设置属性的，但是如果没有设置。同样也可以在 header 里设置上。效果一样。)</p>
<p>例如，如果你想设置一个缓存头，但又不能控制服务器，你可以使用http-equiv 属性：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"expires"</span> <span class="attr">content</span>=<span class="string">"Wed, 05 August 2020 00:00:00 GMT"</span>&gt;</span>.</div></pre></td></tr></table></figure></p>
<p>http-equiv 属性是 http 协议的响应头报文，此属性出现在 meta 标签中。属性值用 content 属性描述当浏览器等设备接收服务器端传送的文件时，首先会接收文件的相关”(名称/值对)”，通常为多个。<br>所有服务器都至少要发送一个：<code>content-type:text/html</code>。这将告诉浏览器准备接受一个 HTML 文档。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"5; url=http://www.a.com/"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"pragma"</span> <span class="attr">content</span>=<span class="string">"no-cache"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>会产生：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Cache</span><span class="params">-Control</span>:<span class="keyword">max</span><span class="params">-age</span>=<span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>no-store 在response 头中是为了声明不让浏览器 存储这次响应的信息。<br>max-age 这个声明过期时间的。单位为秒 0 肯定就是不缓存了。<br>两个选项对于Cache 系统来说。都是比较有用的。</p>
<p>关于 session，cookie，jsessionid 的关系。 session 就是 httpsession，服务器端的， cookie 就是浏览器端的。</p>
<p>在 servlet 里使用了</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">HttpSession session</span> = request.getSession();</div><div class="line"><span class="attribute">String sessionid</span> = session.getId();</div></pre></td></tr></table></figure>
<p>获取了 session ，即使没有在 session 里设置数据，那么在响应里也会去设置 cookie。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">Server:</span>Apache-Coyote/<span class="number">1.1</span></div><div class="line">Set-<span class="string">Cookie:</span>JSESSIONID=<span class="number">3</span>B44FEAE6B662D94F4F23DD8EC2D2697; Path=<span class="regexp">/nodeA/</span>; HttpOnly</div></pre></td></tr></table></figure>
<p>并且有意思的是：如果在浏览器里把 cookie 删掉，那么下一次给服务器发请求，那么必然不会带着 cookie。所以服务器在没有 cookie 的请求中会在响应(因为没有把 cookie 中的 sessionid 带上，那么服务器认为这个客户端还没有对应的 session，于是发一个 session 给这个客户端，并且在返回响应的时候顺便设置在 cookie 上)的时候给带上 cookie（sessionid）。</p>
<p>如果客户端在请求的时候把 cookie(seessionid)带上了，那么服务器就不会在响应中设置 cookie 了。如果浏览器把 cookie 禁用了，那么新的 cookie 是存不到浏览器的，响应的时候带着 cookie 也不管用，存不上。  但是禁用cookie 后，浏览器中存储的囤积的还是可以发送出去的。 </p>
<p>那么问题来了，浏览器把 cookie 禁用了怎么办？ 请求的时候把 sessionid 存放到,貌似没有什么好办法，因为禁用 cookie，服务器的 sessionid 传不进来。在禁用 cookie 的情况下，taobao 登陆不上去，页面显示有问题。 amazon，jd 直接在登陆界面提示，不设置 cookie 登陆不进去。</p>
<p>首部 Referer 请求用户是从这个页面上依照链接跳转过来的. Referer 首部提供了用户来源页面的 URL。改动后包含了用户状态信息的URL 被称为胖URL（fat URL）。</p>
<p>可以笼统地将cookie 分为两类： 会话cookie 和持久cookie。会话cookie 是一种临时cookie，它记录了用户访问站点时的设置和偏好。用户退出浏览器时，会话 cookie 就被删除了。</p>
<p>持久cookie 的生存时间更长一些；它们存储在硬盘上，浏览器退出，计算机重启时它们仍然存在。通常会用持久cookie 维护某个用户会周期性访问的站点的配置文件或登录名。</p>
<p>如果设置了Discard 参数，或者没有设置Expires 或Max-Age 参数来说明扩展的客户端识别与cookie机制过期时间，这个cookie 就是一个会话cookie。</p>
<p>浏览器会记住从服务器返回的Set-Cookie 或Set-Cookie2 首部中的cookie 内容，并将cookie 集存储在浏览器的 cookie 数据库中,将来用户返回同一站点时,浏览器会挑中那个服务器贴到用户上的那些cookie，并在一个cookie 请求首部中将其传回去。 </p>
<p>浏览器只向服务器发送服务器产生的那些cookie。(谁拿来的，再给谁拿回去)</p>
<p>版本 0 的Cookie首部客户端发送请求时，会将所有与域、路径和安全过滤器相匹配的未过期cookie 都发送给这个站点。<br>所有cookie 都被组合到一个Cookie 首部中：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Cookie: session-<span class="built_in">id</span>=<span class="number">002</span><span class="number">-1145265</span><span class="number">-8016838</span>; session-<span class="built_in">id</span>-<span class="built_in">time</span>=<span class="number">1007884800</span></div></pre></td></tr></table></figure>
<p>如果客户端既支持版本0 又支持版本1 的cookie，但从服务器获得的是版本0 的<br>Set-Cookie 首部，就应该带着版本0 的Cookie 首部发送cookie。</p>
<p>在绝大多数浏览器中，可以通过检测<br>navigator.cookieEnabled<br>这个属性实现。</p>
<p>但是为 false 也不代表不能用 cookie，只是表示不能使用持久化 cookie<br>“当前浏览会话生命周期” 的非持久化cookie仍然是启用的。</p>
<p>coookie 的作用域并不是局限在浏览器的单个窗口中，它的有效期和整个浏览器进程而不是单个浏览器窗口的有效期一致。</p>
<p>一且设置了有效期，浏览器就会将cookie数据存储在一个文件中，并且直到过了指定的有效期才会删除该文件。</p>
<p>默认情况下， cookie 和创建它的Web页面有关，并对该Web页面以及和该Web页面同目录或者子目录的其他Web页面可见。对其他目录的文件不可见，即使相同域名。如果把路径设置成”/“ , 那么该cookie对 ‘<a href="http://www.example.com`" target="_blank" rel="external">http://www.example.com`</a> 这台Web服务器上的页面都是可见的。</p>
<p>cookie的 path 属性不能被用做访问控制机制。如果一个Web页面想要读取同站点其他页面的cookie ，只要简单地将其他页面以隐藏<code>&lt;iframe&gt;</code>的形式加载进来，随后读取对应文档的cookie就可以了。同源策略限制了跨站的cookie窥探，但是对于同一站点的文档它是完全合法的。</p>
<p>有的大型网站想要子域之间能够互相共享 cookie. 比如， order.example.com 域下的服务器想要读取catalog.example.com域下设置的cookie值。这个时候就需要通过设置cookie的domain属性来达到目的.  比如设置 document.domain = “example.com”</p>
<p><strong> domain属性的默认值是当前Web服务器的主机名.</strong> 由于cookie的名/值中的值是不允许包含分号、逗号和空白符，因此，在存储前一般可以采用JavaScript核心的全局函数 encodeURIComponent() 对值进行编码。</p>
<p>处理 cookie 的技巧：</p>
<ul>
<li>要改变cookie的值，需要使用相同的名字、路径和域，再使新的值重新设置cookie 的值。</li>
<li>delete 将max-age属性指定为0 ，再次设置cookie 。</li>
<li>document.cookie // 返回所有作用在当前文档的所有 cookie ，多个 cookie 的集合的字符串形式。</li>
</ul>
<blockquote>
<p>  <code>RFC 2965</code> 规定 cookie 不超过300个，为每个Web服务器保存的cookie数不能超过20个,数据不能超过4KB, 现代浏览器允许 cookie 超过300个。</p>
</blockquote>
<p>要给当前文档设置 cookie 值，非常简单，只须将cookie属性设置为一个字符串形式的值:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.cookie=<span class="string">'name_self=abc'</span>;</div><div class="line"><span class="built_in">document</span>.cookie=<span class="string">'name_self=abc;max-age=10'</span>; <span class="comment">// 10秒后过期</span></div><div class="line"><span class="built_in">document</span>.cookie=<span class="string">"name_self=abc;max-age=10;path='/path';domain='http://.domain.com';"</span>; <span class="comment">// 10秒后过期,由于设置了 domain 不限于 domain.com/path/xx  path 目录及其子目录的访问，其他子域名也可访问 cookie。</span></div></pre></td></tr></table></figure>
<p>IE5 以及 IE5 以上版本的浏览器是通过在document元素后面附加一个专属的”DHTML行为”来实现客户端存储的。<br>如  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;!--[<span class="keyword">if</span> IE]&gt;</div><div class="line"></div><div class="line">memory.style.behavior = <span class="string">"url('#default#userData')"</span> </div><div class="line"></div><div class="line">&lt;![endif]--&gt;</div></pre></td></tr></table></figure>
<p>附加userData行为。</p>
<h3 id="网络相关的长度问题"><a href="#网络相关的长度问题" class="headerlink" title="网络相关的长度问题"></a>网络相关的长度问题</h3><p>Http  Get方法提交的数据大小长度并没有限制，HTTP协议规范没有对URL长度进行限制。这个限制是特定的浏览器及服务器对它的限制。<br>IE     限制为2083个字符，如果超过这个数字，提交按钮没有任何反应。<br>Firefox 对于Firefox浏览器URL的长度限制为 65536 个字符。<br>Safari  URL最大长度限制为 80000 个字符。<br>Opera   URL最大长度限制为 190000 个字符。<br>Google  URL最大长度限制为 8182 个字符。<br>Apache  能接受最大url长度为 8192 个字符。</p>
<p>Post 长度限制<br>在Tomcat下取消POST大小的限制（Tomcat默认2M）；<br>打开tomcat目录下的conf目录，打开server.xml 文件，修改maxPostSize</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- &lt;meta http-equiv="refresh" content="5" /&gt; --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"10;url=http://baidu.com"</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!-- 10表示10秒，0即为立即跳转 --&gt;</span></div></pre></td></tr></table></figure>
<h3 id="解析域名"><a href="#解析域名" class="headerlink" title="解析域名"></a>解析域名</h3><p>首先，浏览器需要知道该网站的IP 地址。它向DNS 服务器发送一个包含域名的请求， 然后DNS 服务器返回给<code>浏览器</code>对应的IP 地址。为了减少DNS 服务器上的负载，并提高性能，DNS 查找机制会被浏览器、设备或设备和服务器之间的路由器和代理服务器缓存。这就是为什么更改DNS 记录可能需要几天才能生效的原因。</p>
<h3 id="浏览器是如何显示页面的？"><a href="#浏览器是如何显示页面的？" class="headerlink" title="浏览器是如何显示页面的？"></a>浏览器是如何显示页面的？</h3><ol>
<li>发起请求 </li>
<li>ip地址 返回给浏览器。</li>
<li><p>然后，浏览器会向由DNS 查找得到的IP 地址的主机发起TCP 连接。然后发送请求。<code>Remote Address:106.38.179.49:80</code>, 请求中包含网址、浏览器信息、浏览器能接受的数据类型（编码和语言），以及所有相关的cookie，包括域和路径的cookie。</p>
</li>
<li><p>发起请求, 浏览器开始下载响应。随着响应流到达，浏览器解析HTML 并识别出更多的资源。然后浏览器开始获取这些资源。</p>
</li>
<li><p>渲染页面,最后浏览器会尽快开始渲染页面。如果页面中外链了CSS 或脚本文件时，浏览器会等到这些文件加载和解析（如果是JavaScript 代码，则还需要执行）完再渲染页面。</p>
</li>
</ol>
<h3 id="为什么页面加载缓慢？"><a href="#为什么页面加载缓慢？" class="headerlink" title="为什么页面加载缓慢？"></a>为什么页面加载缓慢？</h3><p>为什么页面加载缓慢？以下是可能的原因：</p>
<ul>
<li>HTTP 连接数</li>
<li>总的字节数</li>
<li>等待时的渲染阻塞</li>
<li>延迟</li>
<li>缓存能力差</li>
</ul>
<p>我们先把重点放在“网络”选项卡上，它有一个美丽的瀑布图，向我们展示了页面加载时的各种信息。<br>每一栏上的浅色代表的延迟，深色代表下载。</p>
<p>iOS 上的Safari 浏览器支持同一域下的最多 6 个资源并行下载。<br>虽然可以通过添加额外的域名（也许是通过设置别名或子域名）的方式来并行下载更多的文件，但每次请求还是需要承担HTTP 层面的开销。</p>
<p>对于图片，因为下载占到了请求时间的绝大部分，所以并行下载更好。出于这个原因（以及一些其他的原因），在网站上将图像与其他资源置于不同的域下是合理的。<br>(对图片设置 cookie 是完全没有必要的，所以最好给图片单独提供一个域名,可能放在专用的图片服务器上了)</p>
<p>雅虎的Steve Souders 和YSlow 团队发现，为当前域创建两个别名，能允许更多的下载并行，会使大文件下载的性能明显改善。</p>
<p>它的第一次加载必然比部署在多个域下的慢。不过由于每个域都需要进行DNS 查找， 添加太多的域反而会更慢。<br>使用至少两个，至多不超过五个域是YSlow 的经验法则。</p>
<p>如果一个 cookie 与请求的域名或路径相匹配，它会伴随着每次请求发送（即上传）。 所以，如果你在你的域名下的第一个请求中设置了几千字节的cookie，那么此后发送到这个域的每次请求都将把这些字节包含在请求头里，然后发送、解压缩。</p>
<p>服务器还必须在读取请求体之前读取这些cookie。cookie 可以把一个很小的请求变得很大。</p>
<p>高延迟使因请求量大而导致的问题激增，因为每次请求都因延迟增加了往返的时间。</p>
<p>对于低流量的网站 CDN 的帮助不大。 不过，把你的静态文件放在一个单独的没有 cookie 的域下总是有帮助的。<br>所以，如果有条件，务必做到这一点。 如果一个 cookie 与请求的域名或路径相匹配，它会伴随每次请求发送。 所以如果你在你的域名下的第一个请求。 （这里说第一个请求是有原因的，因正常情况下后续的服务器响应是不会再次设置 cookie 的。 没有必要在重新设置。 除非在每次服务器响应的时候强制在 response 里设置了 cookie， 这样才可能在每次的响应头中看到 set-cookie。 酱紫。）</p>
<p>设置了几千个字节的 cookie，那么此后发送到这个域的每次请求都会把这些 cookie 包含在请求头中带回去, 导致 cookie 很耗费资源。</p>
<p>另一个有价值的工具是 Charles proxy（Charlesproxy.com）。<br>Charles 是一个本地工具，能让你检查每一个请求，给请求添加断点，还可以模拟低带宽环境。<br>当开发工具没有给出关于HTTP 的更多信息时，Charles 可以帮助你。</p>
<p>pageSpeed 把规则划分为六类：</p>
<ul>
<li>缓存优化，使页面的应用逻辑实现和所需数据一并离线缓存。</li>
<li>往返时间最小化，减少请求响应的周期次数。</li>
<li>请求开销最小化，减少上传数据包大小，（数据包，cookie 在 header 里）</li>
<li>有效负载最小化，减少响应包，下载包和缓存页面的大小。(压缩,图像压缩)</li>
<li>浏览器渲染优化，改进浏览器的页面布局。</li>
<li>移动设备优化，为移动而优化。</li>
</ul>
<blockquote>
<p>对移动端建议：“”延迟 javasript 解析(不必要的 js 不要放在 header)”+“”使首页的重定向可缓存”</p>
</blockquote>
<p>link 标签上的关于媒体查询的css文件，即使查询的结果不合适，也还是会下载的。只不过是不用。</p>
<h2 id="XSS-的防御-输入框验证"><a href="#XSS-的防御-输入框验证" class="headerlink" title="XSS 的防御(输入框验证)"></a>XSS 的防御(输入框验证)</h2><h3 id="什么是-XSS-（cross-site-script）"><a href="#什么是-XSS-（cross-site-script）" class="headerlink" title="什么是 XSS （cross site script）"></a>什么是 XSS （cross site script）</h3><p>为了防止与层叠样式表css混淆，改为 xss； 通常表现为通过输入框插入非法脚本，获取其他用户安全信息。</p>
<p>HTTPOnly ，一个成熟的标准， 浏览器将禁止页面中的 js 访问带有 HTTPOnly 属性的 cookie。<br>IE 6 和 其他现代浏览器均已支持这个标准。所以，HttpOnly 不是用于对抗 XSS，它是用于在 XSS 攻击后，防护 cookie 被读取，从而使大部分 XSS 攻击失去了意义。</p>
<h3 id="一个-cookie-使用的过程大概是这样的："><a href="#一个-cookie-使用的过程大概是这样的：" class="headerlink" title="一个 cookie 使用的过程大概是这样的："></a>一个 cookie 使用的过程大概是这样的：</h3><ol>
<li>浏览器像服务器发起请求，这时没有设置 cookie。</li>
<li>服务器返回发送 Set-Cookie Header， 向客户端浏览器写入 Cookie。</li>
<li>在 cookie 到期前，浏览器发起的所有的请求(即使 ajax，图片)，都会在请求头里写入 cookie。</li>
</ol>
<p>HttpOnly的使用是十分灵活的，它可以只用在最核心的位置。 比如我们的应用中会设置多个 cookie，而 HttpOnly 可以有选择的加在关键 cookie上，实施关键目标重点保护。</p>
<p>给 Cookie 添加 HttpOnly 的代码：</p>
<p>java:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Java:</div><div class="line">		Cookie coki1 = new Cookie("get_acookie_1", "acookieValue");</div><div class="line">		response.addCookie(coki1);</div><div class="line">		Cookie coki2 = new Cookie("get_acookie_2", "acookieValue");</div><div class="line">        // Cookie coki2 = new Cookie("get_acookie_2", "acookieValue;HTTPOnly"); // 这样不管用 </div><div class="line">		coki2.setHttpOnly(true); // ok</div><div class="line">		response.addCookie(coki2);</div><div class="line">C#:</div><div class="line">		HttpCookie ck = new HttpCookie('myCookie');</div><div class="line">		ck.HttpOnly = true;</div><div class="line">		Response.AppendCookie(ck);</div></pre></td></tr></table></figure>
<h3 id="输入检查"><a href="#输入检查" class="headerlink" title="输入检查"></a>输入检查</h3><p>XSS 攻击一般都是在输入框等输入位置输入一些由特殊字符组成的攻击脚本。</p>

	
	</div>
  <a type="button" href="/2014/12/30/2013-12-30-http学习札记/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2014-12-28 </div>
			<div class="article-title"><a href="/2014/12/28/2014-12-28-http协议相关知识整理/" >http协议相关知识整理</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##连接</p>
<p>在HTTP 客户端向服务器发送报文之前，需要用网际协议（Internet Protocol，IP） 地址和端口号在客户端和服务器之间建立一条TCP/IP 连接。<br>HTTP 连接实际上就是TCP 连接及其使用规则。TCP 连接是因特网上的可靠连接。TCP 为HTTP 提供了一条可靠的比特传输管道。从TCP 连接一端填入的字节会从另一端以原有的顺序、正确地传送出来。</p>
<p>浏览器访问服务器的过程：</p>
<ol>
<li>浏览器解析出主机名</li>
<li>浏览器查询这个主机名的IP地址（DNS）</li>
<li>浏览器获得端口号（80）</li>
<li>浏览器发起到 x.x.x.x 端口 xx 的连接</li>
<li>浏览器向服务器发送一条HTTP GET报文</li>
<li>浏览器从服务器读取HTTP响应报文</li>
</ol>
<p>HTTP 事务的时延有以下几种主要原因:</p>
<ol>
<li>客户端首先需要根据URI 确定Web 服务器的IP 地址和端口号。如果最近没有对 URI 中的主机名进行访问，通过DNS 解析系统将URI 中的主机名转换成一个IP 地址可能要花费数十秒的时间。</li>
<li>接下来，客户端会向服务器发送一条TCP 连接请求，并等待服务器回送一个请 求接受应答。每条新的TCP 连接都会有连接建立时延。这个值通常最多只有一 两秒钟，但如果有数百个HTTP 事务的话，这个值会快速地叠加上去。</li>
<li>一旦连接建立起来了，客户端就会通过新建立的TCP 管道来发送HTTP 请求。 数据到达时，Web 服务器会从TCP 连接中读取请求报文，并对请求进行处理</li>
</ol>
<p>大多数HTTP 客户端都有一个小的DNS 缓存，用来保存近期所访问站点的IP 地址。如果 已经在本地“缓存”（记录）了IP 地址，查询就可以立即完成。因为大多数Web 浏览器浏览的都是少数常用站点，所以通常都可以很快地将主机名解析出来。</p>

	
	</div>
  <a type="button" href="/2014/12/28/2014-12-28-http协议相关知识整理/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2014-12-27 </div>
			<div class="article-title"><a href="/2014/12/27/2014-12-27-brick/" >brick</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>先占坑。。<br><a href="https://mozbrick.github.io/blog/" target="_blank" rel="external">https://mozbrick.github.io/blog/</a></p>

	
	</div>
  <a type="button" href="/2014/12/27/2014-12-27-brick/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2014-12-25 </div>
			<div class="article-title"><a href="/2014/12/25/2014-12-25-git/" >git</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>#分布式版本管理的优点</p>
<p>最初的克隆时间较长,特别是历史记录很长的时候,但最终这个本地镜像备份会带来很多优势.一个显而易见的好处是,当产看一个旧版本时不需要和中心服务器通信.</p>
<h1 id="基本技巧"><a href="#基本技巧" class="headerlink" title="基本技巧"></a>基本技巧</h1><h2 id="git-文件的三种状态"><a href="#git-文件的三种状态" class="headerlink" title="git 文件的三种状态"></a>git 文件的三种状态</h2><ol>
<li>暂存 staged </li>
<li>修改 modify</li>
<li>已提交</li>
</ol>
<p>记录当前状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git init</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"my commit description"</span></div></pre></td></tr></table></figure></p>
<p>回退原来编辑的地方,会退到上次版本提交后的最初状态<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset --hard</div></pre></td></tr></table></figure></p>
<p>操作是针对本地版本库中已存在文件的操作, 针对已存在本地版本的文件的修改会完全回退,不管是否已经 <code>git add</code>过,<br>针对新加入的文件, add 之前的文件不会删除掉(untracked file: 尚未加入版本控制), add 之后的文件会被抹掉.</p>
<p>git add 操作开始跟踪文件,但是还没有提交版本库, 类似 hibernate 中的持久态, 具有 id,具有 session 管理.<br>在 commit 之前还没有进入到托管的游离态(所以只有 commit 之前可以进行 git reset 操作).<br>add 之前的文件可以看作是 transient 瞬态, 通过 git add 便把无管理的文件进入到持久态, 受到 git 管控.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add NEWFILES</div></pre></td></tr></table></figure>
<p>删除, 将文件从本地目录，缓存区中删除,提交后才会在本地仓库中删除。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git</span> rm OLDFILES <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>重命名, 不能进行无版本控制的文件,git 还管控不到</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">mv</span> OLDFILES NEWFILES</div></pre></td></tr></table></figure>
<p>看日志</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">log</span></div></pre></td></tr></table></figure>
<p>彻底恢复到指定版本,并且从记录里永久删除掉所有的后续记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="keyword">reset</span> <span class="comment">--hard SHA1_HASH</span></div></pre></td></tr></table></figure>
<p>简单的恢复到以前的某个状态,穿越回去还能回来:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git</span> checkout SHA1_HASH</div></pre></td></tr></table></figure>
<p>checkout 可以回到过去,并且可以保存在过去状态上的更改.但这会开辟新的分支.</p>
<p>回到现实</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout <span class="literal">master</span></div></pre></td></tr></table></figure>
<h2 id="处理分支"><a href="#处理分支" class="headerlink" title="处理分支"></a>处理分支</h2><p>查看分支<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git branch</span></div></pre></td></tr></table></figure></p>
<p>建立分支<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -<span class="selector-tag">b</span> branchName</div></pre></td></tr></table></figure></p>
<p>关于建立分支,实质上是 checkout 到一个某个状态后, git 自动把你放到一个新的,未命名的分支,<br>这个分支可以用<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -<span class="selector-tag">b</span> branchName</div></pre></td></tr></table></figure></p>
<p>进行对该分支命名.</p>
<p>回到主分支<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout <span class="literal">master</span></div></pre></td></tr></table></figure></p>
<p>切换到某分支<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">git checkout someBranch</span></div></pre></td></tr></table></figure></p>
<p>使用分支工作</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git checkout -b draft  <span class="comment"># 建立分支</span></div><div class="line"><span class="built_in">do</span> some work <span class="keyword">in</span> <span class="keyword">the</span> branch: draft <span class="keyword">and</span> commmit  <span class="comment"># 在分支上工作</span></div><div class="line">git checkout master <span class="comment"># 回到分支 master</span></div><div class="line">git <span class="built_in">merge</span> draft <span class="comment"># 将 draft 分支所做更改合并到主分支</span></div><div class="line">git branch -d draft <span class="comment"># 不再需要这个分支</span></div></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2014/12/25/2014-12-25-git/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/4/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/6/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			 

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/bom/">bom<span>1</span></a></li>
		
			<li><a href="/categories/css/code/">code<span>1</span></a></li>
		
			<li><a href="/categories/collection/">collection<span>1</span></a></li>
		
			<li><a href="/categories/css/">css<span>2</span></a></li>
		
			<li><a href="/categories/tools/debug/">debug<span>1</span></a></li>
		
			<li><a href="/categories/default/">default<span>1</span></a></li>
		
			<li><a href="/categories/http/">http<span>1</span></a></li>
		
			<li><a href="/categories/javascript-template/">javascript template<span>1</span></a></li>
		
			<li><a href="/categories/javascript-test/">javascript test<span>1</span></a></li>
		
			<li><a href="/categories/jquery/">jquery<span>1</span></a></li>
		
			<li><a href="/categories/js/">js<span>1</span></a></li>
		
			<li><a href="/categories/library/">library<span>2</span></a></li>
		
			<li><a href="/categories/note/">note<span>1</span></a></li>
		
			<li><a href="/categories/note-vim/">note vim<span>2</span></a></li>
		
			<li><a href="/categories/tool/">tool<span>3</span></a></li>
		
			<li><a href="/categories/tools/">tools<span>1</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/library/">library<span>3</span></a></li>
		
			<li><a href="/tags/css/">css<span>8</span></a></li>
		
			<li><a href="/tags/git/">git<span>4</span></a></li>
		
			<li><a href="/tags/javascript-test/">javascript test<span>1</span></a></li>
		
			<li><a href="/tags/jquery/">jquery<span>3</span></a></li>
		
			<li><a href="/tags/http/">http<span>2</span></a></li>
		
			<li><a href="/tags/document/">document<span>1</span></a></li>
		
			<li><a href="/tags/webcomponent-framework/">webcomponent,framework<span>1</span></a></li>
		
			<li><a href="/tags/default/">default<span>2</span></a></li>
		
			<li><a href="/tags/w3c/">w3c<span>1</span></a></li>
		
			<li><a href="/tags/test/">test<span>3</span></a></li>
		
			<li><a href="/tags/javascript-regexp/">javascript regexp<span>1</span></a></li>
		
			<li><a href="/tags/hg/">hg<span>1</span></a></li>
		
			<li><a href="/tags/build/">build<span>1</span></a></li>
		
			<li><a href="/tags/mobile/">mobile<span>1</span></a></li>
		
			<li><a href="/tags/webcomponent/">webcomponent<span>2</span></a></li>
		
			<li><a href="/tags/shell/">shell<span>1</span></a></li>
		
			<li><a href="/tags/javascript/">javascript<span>9</span></a></li>
		
			<li><a href="/tags/regexp/">regexp<span>6</span></a></li>
		
			<li><a href="/tags/code/">code<span>2</span></a></li>
		
		
		   <li><a href="/tags">...<span>41</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2017/04/23/css书写规范/" ><i class="fa fa-file-o"></i>css 编写习惯</a>
      </li>
    
      <li>
        <a href="/2017/04/23/消除函数的术语歧义/" ><i class="fa fa-file-o"></i>消除函数的术语歧义</a>
      </li>
    
      <li>
        <a href="/2017/04/23/脚本的第一行/" ><i class="fa fa-file-o"></i>脚本语言的第一行</a>
      </li>
    
      <li>
        <a href="/2017/04/23/设计模式简介/" ><i class="fa fa-file-o"></i>设计模式简介</a>
      </li>
    
      <li>
        <a href="/2017/04/23/2013-11-09-requirejs/" ><i class="fa fa-file-o"></i></a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/chenyakun" title="My Github repository." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 yakun.cyk
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<!-- <script src="/js/search.js"></script>  -->

<!-- 
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>
 -->

<!-- 
   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>
 -->

<div class="cb-search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
        opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">

    <input type="text" class="cb-search-content" id="cb-search-content" style="position: fixed; top: 60px" placeholder="文章标题 日期 标签" />

    <div style="position: fixed; top: 16px; right: 16px;">
        <img src="/search/img/cb-close.png"  id="cb-close-btn"/>
    </div>
</div>

<!-- <div style="position: fixed; right: 16px; bottom: 20px;">
    <img src="/search/img/cb-search.png"  id="cb-search-btn"  title="双击ctrl试一下"/>
</div> -->

<link rel="stylesheet" href="/search/css/cb-search.css">
<script src="/search/js/bootstrap3-typeahead.min.js"></script>
<script src="/search/js/cb-search.js"></script>

</body>
   </html>
