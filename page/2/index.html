<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 页 | output stream</title>
  <meta name="author" content="yakun.cyk">
  
  <meta name="description" content="主要内容可能关于 web 技术，感慨心得...">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="output stream"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	    <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
	  <a class="navbar-brand" href="/">output stream</a>
      <div class="collapse navbar-collapse nav-menu">
		    <ul class="nav navbar-nav">
    		  
    		  <li>
    			 <a href="/demos" title="Demos.">
            <i class="fa fa-flask"></i>Demos
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/archives" title="All the articles.">
            <i class="fa fa-archive"></i>归档
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/about" title="About me.">
            <i class="fa fa-user"></i>关于我
    			 </a>
    		  </li>
    		  
    		  <li>
    			 <a href="/#" title="Search Posts.">
            <i class="fa fa-search"></i>搜索
    			 </a>
    		  </li>
    		  
    		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <!--
        <i class="fa fa-heart"></i> 
      -->
      
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-07-17-Git修改历史提交的信息/" >Git修改历史提交的信息</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>##起因<br>公司内部使用的gitlab分支上可以使用未注册的用户提交，但是在master分支上必须是注册用户，就算是提交分支成功了，再往master合并的时候也会出错，所以只能修改历史提交纪录</p>
<p>##解决<br>本质上就是使用<code>git filter-branch</code>，<a href="https://www.kernel.org/pub/software/scm/git/docs/git-filter-branch.html" target="_blank" rel="external">这里</a>是这个命令的详细文档，另外github上提供了一个脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"> </div><div class="line">git filter-branch --env-filter '</div><div class="line"> </div><div class="line">an="$GIT_AUTHOR_NAME"</div><div class="line">am="$GIT_AUTHOR_EMAIL"</div><div class="line">cn="$GIT_COMMITTER_NAME"</div><div class="line">cm="$GIT_COMMITTER_EMAIL"</div><div class="line"> </div><div class="line">if [ "$GIT_COMMITTER_EMAIL" = "your@email.to.match" ]</div><div class="line">then</div><div class="line">    cn="Your New Committer Name"</div><div class="line">    cm="Your New Committer Email"</div><div class="line">fi</div><div class="line">if [ "$GIT_AUTHOR_EMAIL" = "your@email.to.match" ]</div><div class="line">then</div><div class="line">    an="Your New Author Name"</div><div class="line">    am="Your New Author Email"</div><div class="line">fi</div><div class="line"> </div><div class="line">export GIT_AUTHOR_NAME="$an"</div><div class="line">export GIT_AUTHOR_EMAIL="$am"</div><div class="line">export GIT_COMMITTER_NAME="$cn"</div><div class="line">export GIT_COMMITTER_EMAIL="$cm"</div><div class="line">'</div></pre></td></tr></table></figure>
<p><a href="https://help.github.com/articles/changing-author-info" target="_blank" rel="external">地址</a>，注意如果你把cm或者am换成中文的，一定要保证脚本文件是utf-8编码的，否则注释中容易出现乱码</p>

	
	</div>
  <a type="button" href="/2017/02/01/2013-07-17-Git修改历史提交的信息/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/node_harmony/" ></a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>#node harmony<br>They have done away with the –harmony flag - which in Node 0.11+ you had to include if you wanted to use any ES6 features at all. In io.js, you get them right out of the box! The current list of ES6 features enabled by default are:</p>
<p>iojs 已经可以默认支持这些了。</p>
<ul>
<li>let</li>
<li>const</li>
<li>Map</li>
<li>WeakMap/WeakSet</li>
<li>Generators</li>
<li>Binary and Octal literals, 二进制和八进制的字面量</li>
<li>Promises</li>
<li>Pro string method</li>
<li>Symbols</li>
<li>Template strings</li>
</ul>

	
	</div>
  <a type="button" href="/2017/02/01/node_harmony/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-08-10-重布局和重绘/" >前端优化的小范围记录</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="HTML-方面"><a href="#HTML-方面" class="headerlink" title="HTML 方面"></a>HTML 方面</h2><h3 id="重布局和重绘"><a href="#重布局和重绘" class="headerlink" title="重布局和重绘"></a>重布局和重绘</h3><p>重布局和重绘，是 web 页面中最常见的重量级操作。当浏览器需要更新它的呈现模型时，就会发生重布局和重绘。只要加载页面就会发生一次重布局和重绘(浏览器在加载页面时必须至少绘制一次页面）, 但在动态页面的应用中，会发生很多次的重布局和重绘。</p>
<ul>
<li>当改变样式时候，而不该页面的几何布局，将发生重绘。隐藏一个元素，或者改变一个元素的背景色时，都将导致一次重绘</li>
<li>当对页面的结构进行更新时，将导致重布局。从文档中移除元素，或者将元素添加到文档中、改变元素的大小或者改变元素的某些属性，都将导致页面重布局，重布局的代价比重绘大，它涉及到使用当前的 DOM、CSS 的定义，重新计算页面的几何结构。</li>
</ul>
<h3 id="优化措施"><a href="#优化措施" class="headerlink" title="优化措施"></a>优化措施</h3><p> 最少次数的更新 DOM</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="built_in">console</span>.time(<span class="string">'one append, one dom cost'</span>)</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</div><div class="line">		$(<span class="string">"#main table"</span>).append(<span class="string">"&lt;tr&gt;&lt;td&gt;append to row: &lt;/td&gt;&lt;td&gt;"</span> + i + <span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">console</span>.timeEnd(<span class="string">'one append, one dom cost'</span>);</div><div class="line">	<span class="comment">// =&gt; one append, one dom cost: 4952.122ms </span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="built_in">console</span>.time(<span class="string">'accumulate and append cost'</span>);</div><div class="line">	<span class="keyword">var</span> tableRows = <span class="string">""</span>;</div><div class="line">	<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ ) &#123;</div><div class="line">		tableRows += <span class="string">"&lt;tr&gt;&lt;td&gt;accumulate and append, now is at :&lt;/td&gt;&lt;td&gt;"</span>+ i +<span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;</div><div class="line">	&#125;</div><div class="line">    $(<span class="string">"#main table"</span>).append(tableRows);</div><div class="line">	<span class="built_in">console</span>.timeEnd(<span class="string">'accumulate and append cost'</span>);</div><div class="line">	<span class="comment">// =&gt; accumulate and append cost: 117.491ms</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>采用一次想操作 dom 的方法比每次都操作 dom 快了 42 倍。<br><img src="./images/codesnip_20141229215927.png" alt="显著对比"></p>
<h2 id="JS-方面"><a href="#JS-方面" class="headerlink" title="JS 方面"></a>JS 方面</h2><h3 id="缓存计算值"><a href="#缓存计算值" class="headerlink" title="缓存计算值"></a>缓存计算值</h3><h3 id="恰当的适用循环"><a href="#恰当的适用循环" class="headerlink" title="恰当的适用循环"></a>恰当的适用循环</h3><ul>
<li>for (最快的)</li>
<li>$.each(item)</li>
<li><p>Array.forEach(item,index)</p>
<p>  后两种采用回调的方式，涉及到准备执行上下文,进栈出栈的操作，并且由于所有的操作都在函数进行， 当引用了外部作用域的变量，循环体中的代码会反复的在作用链中向上查找。传统的 for 循环在包含它的上下文中执行，没有创建新的执行上下文的负担，同时循环外的变量依然保持在当前作用域中，省去了作用域的向上查找。 </p>
</li>
</ul>
<h2 id="CSS-方面"><a href="#CSS-方面" class="headerlink" title="CSS 方面"></a>CSS 方面</h2><h3 id="高效的使用选择器"><a href="#高效的使用选择器" class="headerlink" title="高效的使用选择器"></a>高效的使用选择器</h3><ul>
<li>解析引擎自右向左的计算每条规则</li>
<li>尽可能的使用具体化的选择器，id 好于 tag</li>
<li><p>避免不必要的冗余</p>
<p>  无论哪种浏览器，适用 id 选择器或单个类选择器都是选择元素最快的方式。</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">"#id"</span>)</div><div class="line">$(<span class="string">".class"</span>)</div><div class="line"></div><div class="line"><span class="comment">//  以下为反模式</span></div><div class="line">$(<span class="string">"section div div div &gt; div #id"</span>)</div><div class="line">$(<span class="string">"section div div div &gt; div .class"</span>)</div><div class="line">$(<span class="string">"section div div div p:not('.class')"</span>)</div></pre></td></tr></table></figure>
<p>适当的使用选择器上下文，如果上下文就是费了九牛加二虎的力气选出来的，不如不加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">".classname"</span>)</div><div class="line"></div><div class="line">$(<span class="string">".classname"</span>,<span class="string">"#id"</span>)  <span class="comment">// 添加一个简单明确的上下文比搜索整个 dom 快些</span></div></pre></td></tr></table></figure>
<h2 id="HTTP-方向"><a href="#HTTP-方向" class="headerlink" title="HTTP 方向"></a>HTTP 方向</h2><ol>
<li>cookie</li>
<li>多域名</li>
</ol>

	
	</div>
  <a type="button" href="/2017/02/01/2013-08-10-重布局和重绘/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-08-21-karma下测试异步载入的js文件/" >karma下测试异步载入的js文件</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>默认情况下<a href="http://karma-runner.github.io/" target="_blank" rel="external">karma</a>是把所有的需要测试文件载入到测试页面，如果我们要对一个jsonp方法或者一个模块载入方法进行测试，它会给出一个找不到文件的提示，原因是karma的本地服务器会把需要测试的文件放在<code>/base/*</code>下，这个搞起来也很方便, 两步就搞定</p>
<ul>
<li>设置karma的conf文件里的<code>files</code></li>
<li>对需要测试的方法进行mock，如果是本地请求路径，加上<code>/base/</code></li>
</ul>
<h2 id="需要测试的方法"><a href="#需要测试的方法" class="headerlink" title="需要测试的方法"></a>需要测试的方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadScript</span> (<span class="params">url, success, charset</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> node = doc.createElement(<span class="string">'script'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (charset) &#123;</div><div class="line">        node.charset = charset;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> re = <span class="regexp">/^(?:loaded|complete|undefined)$/</span>;</div><div class="line">    node.onreadystatechange = node.onload = node.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (re.test(node.readyState)) &#123;</div><div class="line">            node.onload = node.onerror = node.onreadystatechange = <span class="literal">null</span>;</div><div class="line"></div><div class="line">            success.call(node);</div><div class="line">            node = <span class="literal">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    node.async = <span class="literal">true</span>;</div><div class="line">    node.src = url;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> head = documentElement.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>] || doc.documentElement;</div><div class="line">    head.insertBefore(node, head.firstChild);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="karma-conf-js"><a href="#karma-conf-js" class="headerlink" title="karma.conf.js"></a>karma.conf.js</h2><p>测试的代码写在tests/mainSpec.js里，我们要载入tests/loader/1.js，修改karma的配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">... other config code ...</div><div class="line"></div><div class="line">        files: [</div><div class="line">                <span class="comment">//保证loader下的文件可以访问,但是又不会直接引用到页面上</span></div><div class="line">                &#123; <span class="attr">pattern</span>: <span class="string">'tests/loader/*.js'</span>, <span class="attr">included</span>: <span class="literal">false</span> &#125;, </div><div class="line">                <span class="string">'tests/lib/jquery-1.7.2.min.js'</span>,</div><div class="line">                <span class="string">'tests/lib/expect.js'</span>,</div><div class="line">                <span class="string">'tests/configData.js'</span>,</div><div class="line">                <span class="string">'src/loader.js'</span>,</div><div class="line">                <span class="string">'tests/**/*Spec.js'</span></div><div class="line">        ],</div><div class="line">... other config code ...</div></pre></td></tr></table></figure>
<h2 id="mainSpec-js里的改造"><a href="#mainSpec-js里的改造" class="headerlink" title="mainSpec.js里的改造"></a>mainSpec.js里的改造</h2><p>需要在karma的环境中，改造一下loadScript方法，其它环境中可以忽略</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__karma__) &#123; <span class="comment">//只处理在karma的环境中</span></div><div class="line">    <span class="keyword">var</span> __loadScript = loadScript;</div><div class="line">    loadScript= <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</div><div class="line">        <span class="comment">//只处理本地路径 </span></div><div class="line">        <span class="keyword">if</span> (args[<span class="number">0</span>].indexOf(<span class="string">'http://'</span>) == <span class="number">-1</span>) &#123;</div><div class="line">            args[<span class="number">0</span>] = <span class="string">'/base/tests/'</span> + args[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        __loadScript.apply(<span class="literal">null</span>, args);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后写一句最近非常大的一个感悟：没有测试代码的代码都是狗屎代码！</p>

	
	</div>
  <a type="button" href="/2017/02/01/2013-08-21-karma下测试异步载入的js文件/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-01-09.jquery工具方法/" >jQuery工具方法</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>jQuery函数库提供了一个jQuery对象（简写为$），这个对象本身是一个构造函数，可以用来生成jQuery对象的实例。有了实例以后，就可以调用许多针对实例的方法，它们定义jQuery.prototype对象上面（简写为$.fn）。</p>
<p>除了实例对象的方法以外，jQuery对象本身还提供一些方法（即直接定义jQuery对象上面），不需要生成实例就能使用。由于这些方法类似“通用工具”的性质，所以我们把它们称为“工具方法”（utilities）。</p>
<h2 id="常用工具方法"><a href="#常用工具方法" class="headerlink" title="常用工具方法"></a>常用工具方法</h2><p><strong>（1）$.trim</strong></p>
<p>$.trim方法用于移除字符串头部和尾部多余的空格。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.trim(<span class="string">'   Hello   '</span>) <span class="comment">// Hello</span></div></pre></td></tr></table></figure>
<p><strong>（2）$.contains</strong></p>
<p>$.contains方法返回一个布尔值，表示某个DOM元素（第二个参数）是否为另一个DOM元素（第一个参数）的下级元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.contains(<span class="built_in">document</span>.documentElement, <span class="built_in">document</span>.body); </div><div class="line"><span class="comment">// true</span></div><div class="line"></div><div class="line">$.contains(<span class="built_in">document</span>.body, <span class="built_in">document</span>.documentElement); </div><div class="line"><span class="comment">// false</span></div><div class="line"></div><div class="line"></div><div class="line">$.contains 源码解析：</div><div class="line"></div><div class="line"><span class="built_in">document</span>.ownerDocument; <span class="comment">// =&gt; null;</span></div><div class="line"></div><div class="line">contains = hasCompare || rnative.test( docElem.contains ) ?</div><div class="line">		<span class="function"><span class="keyword">function</span>(<span class="params"> a, b </span>) </span>&#123;</div><div class="line">			<span class="keyword">var</span> adown = a.nodeType === <span class="number">9</span> ? a.documentElement : a,</div><div class="line">				bup = b &amp;&amp; b.parentNode;</div><div class="line">			<span class="keyword">return</span> a === bup || !!( bup &amp;&amp; bup.nodeType === <span class="number">1</span> &amp;&amp; (</div><div class="line">				adown.contains ?</div><div class="line">					adown.contains( bup ) :</div><div class="line">					a.compareDocumentPosition &amp;&amp; a.compareDocumentPosition( bup ) &amp; <span class="number">16</span></div><div class="line">			));</div><div class="line">		&#125; :</div><div class="line">		<span class="function"><span class="keyword">function</span>(<span class="params"> a, b </span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span> ( b ) &#123;</div><div class="line">				<span class="keyword">while</span> ( (b = b.parentNode) ) &#123;</div><div class="line">					<span class="keyword">if</span> ( b === a ) &#123;</div><div class="line">						<span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">		&#125;;</div></pre></td></tr></table></figure>
<p><strong>（3）$.each，$.map</strong></p>
<p>$.each方法用于遍历数组和对象，然后返回原始对象。它接受两个参数，分别是数据集合和回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.each([ <span class="number">52</span>, <span class="number">97</span> ], <span class="function"><span class="keyword">function</span>(<span class="params"> index, value </span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( index + <span class="string">": "</span> + value );</div><div class="line">&#125;);</div><div class="line"><span class="comment">// 0: 52 </span></div><div class="line"><span class="comment">// 1: 97 </span></div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">  <span class="attr">p1</span>: <span class="string">"hello"</span>,</div><div class="line">  <span class="attr">p2</span>: <span class="string">"world"</span></div><div class="line">&#125;;</div><div class="line">$.each( obj, <span class="function"><span class="keyword">function</span>(<span class="params"> key, value </span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( key + <span class="string">": "</span> + value );</div><div class="line">&#125;);</div><div class="line"><span class="comment">// p1: hello</span></div><div class="line"><span class="comment">// p2: world</span></div></pre></td></tr></table></figure>
<p>需要注意的，jQuery对象实例也有一个each方法（$.fn.each），两者的作用差不多。</p>
<p>$.map方法也是用来遍历数组和对象，但是会返回一个新对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> a = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>];</div><div class="line">a = $.map(a, <span class="function"><span class="keyword">function</span> (<span class="params">n, i</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> (n.toUpperCase() + i);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// ["A0", "B1", "C2", "D3", "E4"]</span></div></pre></td></tr></table></figure>
<p><strong>（4）$.inArray</strong></p>
<p>$.inArray方法返回一个值在数组中的位置（从0开始）。如果该值不在数组中，则返回-1。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</div><div class="line">$.inArray(<span class="number">4</span>,a) <span class="comment">// 3</span></div></pre></td></tr></table></figure>
<p><strong>（5）$.extend</strong></p>
<p>$.extend方法用于将多个对象合并进第一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> o1 = &#123;<span class="attr">p1</span>:<span class="string">'a'</span>,<span class="attr">p2</span>:<span class="string">'b'</span>&#125;;</div><div class="line"><span class="keyword">var</span> o2 = &#123;<span class="attr">p1</span>:<span class="string">'c'</span>&#125;;</div><div class="line"></div><div class="line">$.extend(o1,o2);</div><div class="line">o1.p1 <span class="comment">// "c"</span></div></pre></td></tr></table></figure>
<p>$.extend的另一种用法是生成一个新对象，用来继承原有对象。这时，它的第一个参数应该是一个空对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> o1 = &#123;<span class="attr">p1</span>:<span class="string">'a'</span>,<span class="attr">p2</span>:<span class="string">'b'</span>&#125;;</div><div class="line"><span class="keyword">var</span> o2 = &#123;<span class="attr">p1</span>:<span class="string">'c'</span>&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o = $.extend(&#123;&#125;,o1,o2);</div><div class="line">o</div><div class="line"><span class="comment">// Object &#123;p1: "c", p2: "b"&#125;</span></div></pre></td></tr></table></figure>
<p>默认情况下，extend方法生成的对象是“浅拷贝”，也就是说，如果某个属性是对象或数组，那么只会生成指向这个对象或数组的指针，而不会复制值。如果想要“深拷贝”，可以在extend方法的第一个参数传入布尔值true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> o1 = &#123;<span class="attr">p1</span>:[<span class="string">'a'</span>,<span class="string">'b'</span>]&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o2 = $.extend(&#123;&#125;,o1);</div><div class="line"><span class="keyword">var</span> o3 = $.extend(<span class="literal">true</span>,&#123;&#125;,o1);</div><div class="line"></div><div class="line">o1.p1[<span class="number">0</span>]=<span class="string">'c'</span>;</div><div class="line"></div><div class="line">o2.p1 <span class="comment">// ["c", "b"]</span></div><div class="line">o3.p1 <span class="comment">// ["a", "b"]</span></div></pre></td></tr></table></figure>
<p>上面代码中，o2是浅拷贝，o3是深拷贝。结果，改变原始数组的属性，o2会跟着一起变，而o3不会。</p>
<p><strong>（6）$.proxy</strong></p>
<p>$.proxy方法类似于ECMAScript 5的bind方法，可以绑定函数的上下文（也就是this对象）和参数，返回一个新函数。</p>
<p>jQuery.proxy()的主要用处是为回调函数绑定上下文对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> o = &#123;</div><div class="line">	<span class="attr">type</span>: <span class="string">"object"</span>,</div><div class="line">	<span class="attr">test</span>: <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.type);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$(<span class="string">"#button"</span>)</div><div class="line">  .on(<span class="string">"click"</span>, o.test) <span class="comment">// 无输出</span></div><div class="line">  .on(<span class="string">"click"</span>, $.proxy(o.test, o)) <span class="comment">// object</span></div></pre></td></tr></table></figure>
<p>上面的代码中，第一个回调函数没有绑定上下文，所以结果为空，没有任何输出；第二个回调函数将上下文绑定为对象o，结果就为object。</p>
<p>这个例子的另一种等价的写法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">"#button"</span>).on( <span class="string">"click"</span>, $.proxy(o, test))</div></pre></td></tr></table></figure>
<p>上面代码的$.proxy(o, test)的意思是，将o的方法test与o绑定。</p>
<p>这个例子表明，proxy方法的写法主要有两种。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">jQuery.proxy(<span class="function"><span class="keyword">function</span>, <span class="title">context</span>)</span></div><div class="line"></div><div class="line">// <span class="title">or</span></div><div class="line"></div><div class="line"><span class="title">jQuery</span>.<span class="title">proxy</span>(<span class="params">context, name</span>)</div></pre></td></tr></table></figure>
<p>第一种写法是为函数（function）指定上下文对象（context），第二种写法是指定上下文对象（context）和它的某个方法名（name）。</p>
<p>再看一个例子。正常情况下，下面代码中的this对象指向发生click事件的DOM对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#myElement'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $(<span class="keyword">this</span>).addClass(<span class="string">'aNewClass'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如果我们想让回调函数延迟运行，使用setTimeout方法，代码就会出错，因为setTimeout使得回调函数在全局环境运行，this将指向全局对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#myElement'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">'aNewClass'</span>);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码中的this，将指向全局对象window，导致出错。</p>
<p>这时，就可以用proxy方法，将this对象绑定到myElement对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#myElement'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    setTimeout($.proxy(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">'aNewClass'</span>); </div><div class="line">    &#125;, <span class="keyword">this</span>), <span class="number">1000</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（7）$.data，$.removeData</strong></p>
<p>$.data方法可以用来在DOM节点上储存数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// 存入数据</span></div><div class="line">$.data(<span class="built_in">document</span>.body, <span class="string">"foo"</span>, <span class="number">52</span> );</div><div class="line"></div><div class="line"><span class="comment">// 读取数据</span></div><div class="line">$.data(<span class="built_in">document</span>.body, <span class="string">"foo"</span>);</div><div class="line"></div><div class="line"><span class="comment">// 读取所有数据</span></div><div class="line">$.data(<span class="built_in">document</span>.body);</div></pre></td></tr></table></figure>
<p>上面代码在网页元素body上储存了一个键值对，键名为“foo”，键值为52。</p>
<p>$.removeData方法用于移除$.data方法所储存的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.data(div, <span class="string">"test1"</span>, <span class="string">"VALUE-1"</span>);</div><div class="line">$.removeData(div, <span class="string">"test1"</span>);</div></pre></td></tr></table></figure>
<p><strong>（8）$.parseHTML，$.parseJSON，$.parseXML</strong></p>
<p>$.parseHTML方法用于将字符串解析为DOM对象。</p>
<p>$.parseJSON方法用于将JSON字符串解析为JavaScript对象，作用与原生的JSON.parse()类似。但是，jQuery没有提供类似JSON.stringify()的方法，即不提供将JavaScript对象转为JSON对象的方法。</p>
<p>$.parseXML方法用于将字符串解析为XML对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> html = $.parseHTML(<span class="string">"hello, &lt;b&gt;my name is&lt;/b&gt; jQuery."</span>);</div><div class="line"><span class="keyword">var</span> obj = $.parseJSON(<span class="string">'&#123;"name": "John"&#125;'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> xml = <span class="string">"&lt;rss version='2.0'&gt;&lt;channel&gt;&lt;title&gt;RSS Title&lt;/title&gt;&lt;/channel&gt;&lt;/rss&gt;"</span>;</div><div class="line"><span class="keyword">var</span> xmlDoc = $.parseXML(xml);</div></pre></td></tr></table></figure>
<p><strong>（9）$.makeArray</strong></p>
<p>$.makeArray方法将一个类似数组的对象，转化为真正的数组。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> a = $.makeArray(<span class="built_in">document</span>.getElementsByTagName(<span class="string">"div"</span>));</div></pre></td></tr></table></figure>
<p><strong>（10）$.merge</strong></p>
<p>$.merge方法用于将一个数组（第二个参数）合并到另一个数组（第一个参数）之中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> a1 = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>];</div><div class="line"><span class="keyword">var</span> a2 = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</div><div class="line">$.merge(a1, a2);</div><div class="line"></div><div class="line">a1</div><div class="line"><span class="comment">// [0, 1, 2, 2, 3, 4]</span></div></pre></td></tr></table></figure>
<p><strong>（11）$.now</strong></p>
<p>$.now方法返回当前时间距离1970年1月1日00:00:00 UTC对应的毫秒数，等同于(new Date).getTime()。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.now()</div><div class="line"><span class="comment">// 1388212221489</span></div></pre></td></tr></table></figure>
<h2 id="判断数据类型的方法"><a href="#判断数据类型的方法" class="headerlink" title="判断数据类型的方法"></a>判断数据类型的方法</h2><p>jQuery提供一系列工具方法，用来判断数据类型，以弥补JavaScript原生的typeof运算符的不足。以下方法对参数进行判断，返回一个布尔值。</p>
<ul>
<li>jQuery.isArray()：是否为数组。</li>
<li>jQuery.isEmptyObject()：是否为空对象（不含可枚举的属性）。</li>
<li>jQuery.isFunction()：是否为函数。</li>
<li>jQuery.isNumeric()：是否为数值（整数或浮点数）。</li>
<li>jQuery.isPlainObject()：是否为使用“{}”或“new Object”生成的对象，而不是浏览器原生提供的对象。</li>
<li>jQuery.isWindow()：是否为window对象。</li>
<li>jQuery.isXMLDoc()：判断一个DOM节点是否处于XML文档之中。</li>
</ul>
<p>下面是一些例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.isEmptyObject(&#123;&#125;) <span class="comment">// true</span></div><div class="line">$.isPlainObject(<span class="built_in">document</span>.location) <span class="comment">// false</span></div><div class="line">$.isWindow(<span class="built_in">window</span>) <span class="comment">// true</span></div><div class="line">$.isXMLDoc(<span class="built_in">document</span>.body) <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>除了上面这些方法以外，还有一个$.type方法，可以返回一个变量的数据类型。它的实质是用Object.prototype.toString方法读取对象内部的[[Class]]属性（参见《标准库》的Object对象一节）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.type(<span class="regexp">/test/</span>) <span class="comment">// "regexp"</span></div></pre></td></tr></table></figure>
<h2 id="Ajax操作"><a href="#Ajax操作" class="headerlink" title="Ajax操作"></a>Ajax操作</h2><h3 id="ajax"><a href="#ajax" class="headerlink" title="$.ajax"></a>$.ajax</h3><p>jQuery对象上面还定义了Ajax方法（$.ajax()），用来处理Ajax操作。调用该方法后，浏览器就会向服务器发出一个HTTP请求。</p>
<p>$.ajax()的用法主要有两种。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(url[, options])</div><div class="line">$.ajax([options])</div></pre></td></tr></table></figure>
<p>上面代码中的url，指的是服务器网址，options则是一个对象参数，设置Ajax请求的具体参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(&#123;</div><div class="line">  <span class="attr">async</span>: <span class="literal">true</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'/url/to/json'</span>,</div><div class="line">  <span class="attr">type</span>: <span class="string">'GET'</span>,</div><div class="line">  <span class="attr">data</span> : &#123; <span class="attr">id</span> : <span class="number">123</span> &#125;,</div><div class="line">  <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line">  <span class="attr">timeout</span>: <span class="number">30000</span>,</div><div class="line">  <span class="attr">success</span>: successCallback,</div><div class="line">  <span class="attr">error</span>: errorCallback,</div><div class="line">  <span class="attr">complete</span>: completeCallback,</div><div class="line">  <span class="attr">statusCode</span>: &#123;</div><div class="line">        <span class="number">404</span>: handler404,</div><div class="line">        <span class="number">500</span>: handler500</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">successCallback</span>(<span class="params">json</span>) </span>&#123;</div><div class="line">	$(<span class="string">'&lt;h1/&gt;'</span>).text(json.title).appendTo(<span class="string">'body'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">errorCallback</span>(<span class="params">xhr, status</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'出问题了！'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">completeCallback</span>(<span class="params">xhr, status</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'Ajax请求已结束。'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码的对象参数有多个属性，含义如下：</p>
<ul>
<li>accepts：将本机所能处理的数据类型，告诉服务器。</li>
<li>async：该项默认为true，如果设为false，则表示发出的是同步请求。</li>
<li>beforeSend：指定发出请求前，所要调用的函数，通常用来对发出的数据进行修改。</li>
<li>cache：该项默认为true，如果设为false，则浏览器不缓存返回服务器返回的数据。注意，浏览器本身就不会缓存POST请求返回的数据，所以即使设为false，也只对HEAD和GET请求有效。</li>
<li>complete：指定当HTTP请求结束时（请求成功或请求失败的回调函数，此时已经运行完毕）的回调函数。不管请求成功或失败，该回调函数都会执行。它的参数为发出请求的原始对象以及返回的状态信息。</li>
<li>contentType：发送到服务器的数据类型。</li>
<li>context：指定一个对象，作为所有Ajax相关的回调函数的this对象。</li>
<li>crossDomain：该属性设为true，将强制向相同域名发送一个跨域请求（比如JSONP）。</li>
<li>data：向服务器发送的数据，如果使用GET方法，此项将转为查询字符串，附在网址的最后。</li>
<li>dataType：向服务器请求的数据类型，可以设为text、html、script、json、jsonp和xml。</li>
<li>error：请求失败时的回调函数，函数参数为发出请求的原始对象以及返回的状态信息。</li>
<li>headers：指定HTTP请求的头信息。</li>
<li>ifModified：如果该属性设为true，则只有当服务器端的内容与上次请求不一样时，才会发出本次请求。</li>
<li>jsonp：指定JSONP请求“callback=?”中的callback的名称。</li>
<li>jsonpCallback: 指定JSONP请求中回调函数的名称。</li>
<li>mimeType：指定HTTP请求的mime type。</li>
<li>password：指定HTTP认证所需要的密码。</li>
<li>statusCode：值为一个对象，为服务器返回的状态码，指定特别的回调函数。</li>
<li>success：请求成功时的回调函数，函数参数为服务器传回的数据、状态信息、发出请求的原始对象。</li>
<li>timeout: 等待的最长毫秒数。如果过了这个时间，请求还没有返回，则自动将请求状态改为失败。</li>
<li>type：向服务器发送信息所使用的HTTP动词，默认为GET，其他动词有POST、PUT、DELETE。</li>
<li>url：服务器端网址。这是唯一必需的一个属性，其他属性都可以省略。</li>
<li>username：指定HTTP认证的用户名。</li>
<li>xhr：指定生成XMLHttpRequest对象时的回调函数。</li>
</ul>
<p>这些参数之中，url可以独立出来，作为ajax方法的第一个参数。也就是说，上面代码还可以写成下面这样。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(<span class="string">'/url/to/json'</span>,&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'GET'</span>,</div><div class="line">  <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line">  <span class="attr">success</span>: successCallback,</div><div class="line">  <span class="attr">error</span>: errorCallback</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>作为向服务器发送的数据，data属性也可以写成一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    url: <span class="string">'/remote/url'</span>,</div><div class="line">    <span class="attr">data</span>: &#123;</div><div class="line">        <span class="attr">param1</span>: <span class="string">'value1'</span>,</div><div class="line">        <span class="attr">param2</span>: <span class="string">'value2'</span></div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 相当于</span></div><div class="line">$.ajax(&#123;</div><div class="line">    <span class="attr">url</span>: <span class="string">'/remote/url?param1=value1&amp;param2=value2...'</span></div><div class="line">&#125;&#125;);</div></pre></td></tr></table></figure>
<h3 id="简便写法"><a href="#简便写法" class="headerlink" title="简便写法"></a>简便写法</h3><p>ajax方法还有一些简便写法。</p>
<ul>
<li>$.get()：发出GET请求。</li>
<li>$.getScript()：读取一个JavaScript脚本文件并执行。</li>
<li>$.getJSON()：发出GET请求，读取一个JSON文件。</li>
<li>$.post()：发出POST请求。</li>
<li>$.fn.load()：读取一个html文件，并将其放入当前元素之中。</li>
</ul>
<p>一般来说，这些简便方法依次接受三个参数：url、数据、成功时的回调函数。</p>
<p><strong>（1）$.get()，$.post()</strong></p>
<p>这两个方法分别对应HTTP的GET方法和POST方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.get(<span class="string">'/data/people.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</div><div class="line">  $(<span class="string">'#target'</span>).html(html);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">$.post(<span class="string">'/data/save'</span>, &#123;<span class="attr">name</span>: <span class="string">'Rebecca'</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(resp));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>get方法和post方法的参数相同，第一个参数是服务器网址，该参数是必需的，其他参数都是可选的。第二个参数是发送给服务器的数据，第三个参数是操作成功后的回调函数。</p>
<p>上面的post方法对应的ajax写法如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(&#123;</div><div class="line">    <span class="attr">type</span>: <span class="string">'POST'</span>,</div><div class="line">    <span class="attr">url</span>: <span class="string">'/data/save'</span>,</div><div class="line">    <span class="attr">data</span>: &#123;<span class="attr">name</span>: <span class="string">'Rebecca'</span>&#125;,</div><div class="line">    <span class="attr">dataType</span>: <span class="string">'json'</span>,</div><div class="line">    <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.parse(resp));</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（2）$.getJSON()</strong></p>
<p>ajax方法的另一个简便写法是getJSON方法。当服务器端返回JSON格式的数据，可以用这个方法代替$.ajax方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.getJSON(<span class="string">'url/to/json'</span>, &#123;<span class="string">'a'</span>: <span class="number">1</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(data);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面的代码等同于下面的写法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(&#123;</div><div class="line">  <span class="attr">dataType</span>: <span class="string">"json"</span>,</div><div class="line">  <span class="attr">url</span>: <span class="string">'/url/to/data'</span>,</div><div class="line">  <span class="attr">data</span>: &#123;<span class="string">'a'</span>: <span class="number">1</span>&#125;,</div><div class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(data);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（3）$.getScript()</strong></p>
<p>$.getScript方法用于从服务器端加载一个脚本文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.getScript(<span class="string">'/static/js/myScript.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	functionFromMyScript();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码先从服务器加载myScript.js脚本，然后在回调函数中执行该脚本提供的函数。</p>
<p>getScript的回调函数接受三个参数，分别是脚本文件的内容，HTTP响应的状态信息和ajax对象实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.getScript( <span class="string">"ajax/test.js"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data, textStatus, jqxhr</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( data ); <span class="comment">// test.js的内容</span></div><div class="line">  <span class="built_in">console</span>.log( textStatus ); <span class="comment">// Success</span></div><div class="line">  <span class="built_in">console</span>.log( jqxhr.status ); <span class="comment">// 200</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>getScript是ajax方法的简便写法，因此返回的是一个deferred对象，可以使用deferred接口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">jQuery.getScript(<span class="string">"/path/to/myscript.js"</span>)</div><div class="line">	.done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// ...</span></div><div class="line">	&#125;)</div><div class="line">	.fail(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（4）$.fn.load()</strong></p>
<p>$.fn.load不是jQuery的工具方法，而是定义在jQuery对象实例上的方法，用于获取服务器端的HTML文件，将其放入当前元素。由于该方法也属于ajax操作，所以放在这里一起讲。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#newContent'</span>).load(<span class="string">'/foo.html'</span>);</div></pre></td></tr></table></figure>
<p>$.fn.load方法还可以指定一个选择器，将远程文件中匹配选择器的部分，放入当前元素，并指定操作完成时的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#newContent'</span>).load(<span class="string">'/foo.html #myDiv h1:first'</span>,</div><div class="line">	<span class="function"><span class="keyword">function</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'内容更新！'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码只加载foo.html中匹配“#myDiv h1:first”的部分，加载完成后会运行指定的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#main-menu a'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">   event.preventDefault();</div><div class="line"></div><div class="line">   $(<span class="string">'#main'</span>).load(<span class="keyword">this</span>.href + <span class="string">' #main *'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面的代码将指定网页中匹配“#main *”，加载入当前的main元素。星号表示匹配main元素包含的所有子元素，如果不加这个星号，就会加载整个main元素（包括其本身），导致一个main元素中还有另一个main元素。</p>
<p>load方法可以附加一个字符串或对象作为参数，一起向服务器提交。如果是字符串，则采用GET方法提交；如果是对象，则采用POST方法提交。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$( <span class="string">"#feeds"</span> ).load( <span class="string">"feeds.php"</span>, &#123; <span class="attr">limit</span>: <span class="number">25</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log( <span class="string">"已经载入"</span> );</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码将<code>{ limit: 25 }</code>通过POST方法向服务器提交。</p>
<p>load方法的回调函数，可以用来向用户提示操作已经完成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#main-menu a'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">   event.preventDefault();</div><div class="line"> </div><div class="line">   $(<span class="string">'#main'</span>).load(<span class="keyword">this</span>.href + <span class="string">' #main *'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">responseText, status</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (status === <span class="string">'success'</span>) &#123;</div><div class="line">         $(<span class="string">'#notification-bar'</span>).text(<span class="string">'加载成功！'</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">         $(<span class="string">'#notification-bar'</span>).text(<span class="string">'出错了！'</span>);</div><div class="line">      &#125;</div><div class="line">   &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="Ajax事件"><a href="#Ajax事件" class="headerlink" title="Ajax事件"></a>Ajax事件</h3><p>jQuery提供以下一些方法，用于指定特定的AJAX事件的回调函数。</p>
<ul>
<li>.ajaxComplete()：ajax请求完成。</li>
<li>.ajaxError()：ajax请求出错。</li>
<li>.ajaxSend()：ajax请求发出之前。</li>
<li>.ajaxStart()：第一个ajax请求开始发出，即没有还未完成ajax请求。</li>
<li>.ajaxStop()：所有ajax请求完成之后。</li>
<li>.ajaxSuccess()：ajax请求成功之后。</li>
</ul>
<p>下面是示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$(<span class="string">'#loading_indicator'</span>)</div><div class="line">.ajaxStart(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).show();&#125;)</div><div class="line">.ajaxStop(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;$(<span class="keyword">this</span>).hide();&#125;);</div></pre></td></tr></table></figure>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>ajax方法返回的是一个deferred对象，可以用then方法为该对象指定回调函数（详细解释参见《deferred对象》一节）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(&#123;</div><div class="line">  <span class="attr">url</span>: <span class="string">'/data/people.json'</span>,</div><div class="line">  <span class="attr">dataType</span>: <span class="string">'json'</span></div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(resp.people);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>由于浏览器存在“同域限制”，ajax方法只能向当前网页所在的域名发出HTTP请求。但是，通过在当前网页中插入script元素（\<script\>），可以向不同的域名发出GET请求，这种变通方法叫做JSONP（JSON with Padding）。</script\></p>
<p>ajax方法可以发出JSONP请求，方法是在对象参数中指定dataType为JSONP。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajax(&#123;</div><div class="line">  <span class="attr">url</span>: <span class="string">'/data/search.jsonp'</span>,</div><div class="line">  <span class="attr">data</span>: &#123;<span class="attr">q</span>: <span class="string">'a'</span>&#125;,</div><div class="line">  <span class="attr">dataType</span>: <span class="string">'jsonp'</span>,</div><div class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</div><div class="line">    $(<span class="string">'#target'</span>).html(<span class="string">'Results: '</span> + resp.results.length);</div><div class="line">  &#125;</div><div class="line">&#125;);)</div></pre></td></tr></table></figure>
<p>JSONP的通常做法是，在所要请求的URL后面加在回调函数的名称。ajax方法规定，如果所请求的网址以类似“callback=?”的形式结尾，则自动采用JSONP形式。所以，上面的代码还可以写成下面这样。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.getJSON(<span class="string">'/data/search.jsonp?q=a&amp;callback=?'</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">resp</span>) </span>&#123;</div><div class="line">    $(<span class="string">'#target'</span>).html(<span class="string">'Results: '</span> + resp.results.length);</div><div class="line">  &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li>David Walsh, <a href="http://davidwalsh.name/loading-scripts-jquery" target="_blank" rel="external">Loading Scripts with jQuery</a></li>
<li>Nguyen Huu Phuoc, <a href="http://programer.tips/2014/09/best-jquery-practices.html" target="_blank" rel="external">Best jQuery practices</a></li>
</ul>

	
	</div>
  <a type="button" href="/2017/02/01/2013-01-09.jquery工具方法/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-10-06-利用github的api显示当前文章的历史记录/" >利用github的api显示当前文章的历史记录</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>利用github放blog也有一段时间了，一直想做一个小功能，就是展示某个文章的历史纪录，简单来说就是<code>git log 某个文章</code></p>
<h2 id="两种思路"><a href="#两种思路" class="headerlink" title="两种思路"></a>两种思路</h2><ul>
<li>写一个jekyll的插件</li>
<li>js利用github的api</li>
</ul>
<h3 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h3><p>由于github上的jekyll生成网站时是不允许使用的自定义插件的，这个思路暂时忽略。事实上，可以在本地生成静态网站，然后上传到github上，直接使用<code>gh-pages</code>分支来展示，因为不太想重新建一个repo，这个思路暂时忽略吧。</p>
<h3 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h3><p>利用github的<a href="http://developer.github.com/v3/repos/commits/" target="_blank" rel="external">commits api</a>，比如一个文章的commits可以用下面的请求获取, 指定<code>path</code>参数就可以获取特定文件的提交纪录。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$.getJSON(<span class="string">'https://api.github.com/repos/jserme/jserme.github.io/commits?path=_posts%2F2013-07-29-lion%E4%B8%8B%E7%9A%84safari6%E5%AF%B9%E7%BA%AF%E6%95%B0%E5%AD%97%E4%BD%BF%E7%94%A8toString%E6%8A%A5%E9%94%99.md'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;<span class="built_in">console</span>.log(data)&#125;)</div></pre></td></tr></table></figure>
<p>返回的数据格式是一个数组，在每个文章页面加上下面一个id为history的div，然后通过下面的js渲染出对应html，展示效果见每个文章的下方</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取脚本函数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadJs</span>(<span class="params">src, callback</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> doc = <span class="built_in">document</span>;</div><div class="line">    <span class="keyword">var</span> head = doc.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> script = doc.createElement(<span class="string">'script'</span>);</div><div class="line">    <span class="keyword">var</span> re = <span class="regexp">/^(?:loaded|complete|undefined)$/</span>;</div><div class="line"></div><div class="line">    script.onreadystatechange = script.onload = script.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (re.test(script.readyState)) &#123;</div><div class="line">            callback();</div><div class="line">            script.onload = script.onerror = script.onreadystatechange = <span class="literal">null</span>;</div><div class="line">            script = <span class="literal">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    script.src = src;</div><div class="line">    script.async = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    head.insertBefore(script, head.firstChild);</div><div class="line">&#125;</div><div class="line"></div><div class="line">loadJs(<span class="string">'/js/jquery-1.7.2.min.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    loadJs(<span class="string">'/js/md5.min.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//取到文章的路径，追加到请求地址上</span></div><div class="line">        <span class="comment">//可以通过&#123;&#123;page.path&#125;&#125;来取到</span></div><div class="line">        <span class="keyword">var</span> articlePath =<span class="string">'&#123;&#123;page.path&#125;&#125;'</span></div><div class="line">        <span class="keyword">var</span> api = <span class="string">'https://api.github.com/repos/jserme/jserme.github.io/commits?path='</span></div><div class="line">        <span class="keyword">var</span> tmpl = <span class="string">'&lt;div class="article"&gt;\</span></div><div class="line">                        &lt;span class="datetime"&gt;&#123;date&#125;&lt;/span&gt;\</div><div class="line">                        &lt;span&gt;\</div><div class="line">                            &lt;image src="&#123;src&#125;" title="&#123;author&#125;"&gt;\</div><div class="line">                            &#123;message&#125;\</div><div class="line">                        &lt;/span&gt;\</div><div class="line">                    &lt;/div&gt;'</div><div class="line">            <span class="keyword">var</span> gravstarurl = <span class="string">'https://1.gravatar.com/avatar/&#123;md5hash&#125;?s=16'</span>; </div><div class="line">            $.getJSON(api + articlePath,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>( data.length == <span class="number">0</span> )&#123;</div><div class="line">                    $(<span class="string">'#history'</span>).html(<span class="string">'暂无历史纪录 :)'</span>);</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> history = <span class="string">''</span>;</div><div class="line">            $.each(data, <span class="function"><span class="keyword">function</span>(<span class="params">i, v</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> avatar = gravstarurl.replace(<span class="string">'&#123;md5hash&#125;'</span>, md5(v.commit.author.email));</div><div class="line">                history += tmpl.replace(<span class="string">'&#123;src&#125;'</span>, avatar)</div><div class="line">                               .replace(<span class="string">'&#123;date&#125;'</span>, v.commit.author.date.replace(<span class="regexp">/T.*Z/</span>,<span class="string">''</span>))</div><div class="line">                               .replace(<span class="string">'&#123;message&#125;'</span>, v.commit.message);</div><div class="line">                &#125;);</div><div class="line"></div><div class="line">            $(<span class="string">'#history'</span>).html(history);</div><div class="line">        &#125;)</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>详细的文件可以查看<a href="https://github.com/jserme/jserme.github.io/blob/master/_layouts/post.html#L41" target="_blank" rel="external">这里</a></p>

	
	</div>
  <a type="button" href="/2017/02/01/2013-10-06-利用github的api显示当前文章的历史记录/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-08-20-javascript的几种使用多行字符串的方式/" >javascript的几种使用多行字符串的方式</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>JS里并没有标准的多行字符串的表示方法，但是在用模板的时候，为了保证模板的可阅读性，我们又不可避免的使用多行字符串，所以出现了各种搞法，这里以一段jade的模板作为示例，简单总结和对比一下。</p>
<h2 id="字符串相加"><a href="#字符串相加" class="headerlink" title="字符串相加"></a>字符串相加</h2><p>这是最容易理解也很常用的一种形式，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tmpl =<span class="string">''</span>+</div><div class="line">    <span class="string">'!!! 5'</span> +</div><div class="line">    <span class="string">'html'</span> +</div><div class="line">    <span class="string">'  include header'</span> +</div><div class="line">    <span class="string">'  body'</span> +</div><div class="line">    <span class="string">'    //if IE 6'</span> +</div><div class="line">    <span class="string">'        .alert.alert-error'</span> +</div><div class="line">    <span class="string">'            center 对不起，我们不支持IE6，请升级你的浏览器'</span> +</div><div class="line">    <span class="string">'                a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载'</span> +</div><div class="line">    <span class="string">'                a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载'</span> +</div><div class="line">    <span class="string">'    include head'</span> +</div><div class="line">    <span class="string">'    .container'</span> +</div><div class="line">    <span class="string">'        .row-fluid'</span> +</div><div class="line">    <span class="string">'            .span8'</span> +</div><div class="line">    <span class="string">'                block main'</span> +</div><div class="line">    <span class="string">'                include pagerbar'</span> +</div><div class="line">    <span class="string">'            .span4'</span> +</div><div class="line">    <span class="string">'                include sidebar'</span> +</div><div class="line">    <span class="string">'    include footer'</span> +</div><div class="line">    <span class="string">'    include script'</span></div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>易理解，简单，可靠 </li>
<li>足够灵活，可以在单个字符串中添加js逻辑 </li>
</ul>
<p>缺点 :</p>
<ul>
<li>并不是真正意义上的多行字符串, 如果想要真正的多行，需要自己加<code>\n</code> </li>
<li>大量的<code>+</code>号看上去满天星,大量的<code>&#39;</code>和<code>&quot;</code>, 丑陋</li>
</ul>
<h2 id="反斜线"><a href="#反斜线" class="headerlink" title="反斜线"></a>反斜线</h2><p>这个叫续行符, 这个并非一种很常见的方式, 但是一旦用上了，还是很容易上瘾，只需要加一个字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tmpl =<span class="string">'\</span></div><div class="line">    !!! 5\</div><div class="line">    html\</div><div class="line">      include header\</div><div class="line">      body\</div><div class="line">        //if IE 6\</div><div class="line">            .alert.alert-error\</div><div class="line">                center 对不起，我们不支持IE6，请升级你的浏览器\</div><div class="line">                    a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载\</div><div class="line">                    a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载\</div><div class="line">        include head\</div><div class="line">        .container\</div><div class="line">            .row-fluid\</div><div class="line">                .span8\</div><div class="line">                    block main\</div><div class="line">                    include pagerbar\</div><div class="line">                .span4\</div><div class="line">                    include sidebar\</div><div class="line">        include footer\</div><div class="line">        include script'</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>简单,每一行只需要有多一个<code>\</code></li>
<li>高效！在大部分的浏览器上，这种方式都是最快的，看这个<a href="http://jsperf.com/zp-string-concatenation/6" target="_blank" rel="external">效率对比</a></li>
</ul>
<p>缺点 :</p>
<ul>
<li>致命缺陷，每一行的<code>\</code>必须不可以有空格，否则直接脚本错误 </li>
<li>并不是真正意义上的多行字符串, 如果想要真正的多行，需要自己加<code>\n</code> </li>
<li>尽管绝大部分的js引擎都支持它，但是它并不是ECMAScript的一部分(我并没有研究规范，这句话是从<a href="http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml?showone=Multiline_string_literals#Multiline_string_literals" target="_blank" rel="external">google的编码规范</a>翻译过来的)</li>
</ul>
<h2 id="字符串数组join"><a href="#字符串数组join" class="headerlink" title="字符串数组join"></a>字符串数组join</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tmpl = [</div><div class="line">    <span class="string">'!!! 5'</span> ,</div><div class="line">    <span class="string">'html'</span> ,</div><div class="line">    <span class="string">'  include header'</span> ,</div><div class="line">    <span class="string">'  body'</span> ,</div><div class="line">    <span class="string">'    //if IE 6'</span> ,</div><div class="line">    <span class="string">'        .alert.alert-error'</span> ,</div><div class="line">    <span class="string">'            center 对不起，我们不支持IE6，请升级你的浏览器'</span> ,</div><div class="line">    <span class="string">'                a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载'</span> ,</div><div class="line">    <span class="string">'                a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载'</span> ,</div><div class="line">    <span class="string">'    include head'</span> ,</div><div class="line">    <span class="string">'    .container'</span> ,</div><div class="line">    <span class="string">'        .row-fluid'</span> ,</div><div class="line">    <span class="string">'            .span8'</span> ,</div><div class="line">    <span class="string">'                block main'</span> ,</div><div class="line">    <span class="string">'                include pagerbar'</span> ,</div><div class="line">    <span class="string">'            .span4'</span> ,</div><div class="line">    <span class="string">'                include sidebar'</span> ,</div><div class="line">    <span class="string">'    include footer'</span> ,</div><div class="line">    <span class="string">'    include script'</span>].join(<span class="string">'\n'</span>);</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>真正意义上的多行字符串 </li>
<li>易理解，简单，可靠 </li>
<li>足够灵活，可以在单个字符串中添加js逻辑 </li>
</ul>
<p>缺点 :</p>
<ul>
<li>大量的<code>,</code>号和<code>&#39;</code>、<code>&quot;</code>, 丑陋</li>
</ul>
<h2 id="String-prototype-concat"><a href="#String-prototype-concat" class="headerlink" title="String.prototype.concat"></a>String.prototype.concat</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tmpl = <span class="built_in">String</span>.prototype.concat.call(</div><div class="line">    <span class="string">'!!! 5'</span> ,</div><div class="line">    <span class="string">'html'</span> ,</div><div class="line">    <span class="string">'  include header'</span> ,</div><div class="line">    <span class="string">'  body'</span> ,</div><div class="line">    <span class="string">'    //if IE 6'</span> ,</div><div class="line">    <span class="string">'        .alert.alert-error'</span> ,</div><div class="line">    <span class="string">'            center 对不起，我们不支持IE6，请升级你的浏览器'</span> ,</div><div class="line">    <span class="string">'                a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载'</span> ,</div><div class="line">    <span class="string">'                a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载'</span> ,</div><div class="line">    <span class="string">'    include head'</span> ,</div><div class="line">    <span class="string">'    .container'</span> ,</div><div class="line">    <span class="string">'        .row-fluid'</span> ,</div><div class="line">    <span class="string">'            .span8'</span> ,</div><div class="line">    <span class="string">'                block main'</span> ,</div><div class="line">    <span class="string">'                include pagerbar'</span> ,</div><div class="line">    <span class="string">'            .span4'</span> ,</div><div class="line">    <span class="string">'                include sidebar'</span> ,</div><div class="line">    <span class="string">'    include footer'</span> ,</div><div class="line">    <span class="string">'    include script'</span>);</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>不常用，事实上字符串的concat方法远没有<code>+</code>号常见</li>
<li>易理解，简单，可靠 </li>
<li>足够灵活，可以在单个字符串中添加js逻辑 </li>
</ul>
<p>缺点 :</p>
<ul>
<li>并不是真正意义上的多行字符串 </li>
<li>大量的<code>,</code>号和<code>&#39;</code>、<code>&quot;</code>, 丑陋</li>
</ul>
<h2 id="heredoc"><a href="#heredoc" class="headerlink" title="heredoc"></a>heredoc</h2><p>这是一种很有技巧的解决办法, 利用了function的toString方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">heredoc</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> fn.toString().split(<span class="string">'\n'</span>).slice(<span class="number">1</span>,<span class="number">-1</span>).join(<span class="string">'\n'</span>) + <span class="string">'\n'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> tmpl = heredoc(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="comment">/*</span></div><div class="line">    !!! 5</div><div class="line">    html</div><div class="line">      include header</div><div class="line">      body</div><div class="line">        //if IE 6</div><div class="line">            .alert.alert-error</div><div class="line">                center 对不起，我们不支持IE6，请升级你的浏览器</div><div class="line">                    a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载</div><div class="line">                    a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载</div><div class="line">        include head</div><div class="line">        .container</div><div class="line">            .row-fluid</div><div class="line">                .span8</div><div class="line">                    block main</div><div class="line">                    include pagerbar</div><div class="line">                .span4</div><div class="line">                    include sidebar</div><div class="line">        include footer</div><div class="line">        include script</div><div class="line"> */&#125;);</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>模板字符串内不必写多余的任何字符，干净，简单 </li>
<li>真正意义上的多行字符串, 有<code>\n</code>哦 </li>
</ul>
<p>缺点 :</p>
<ul>
<li>不可以在单个字符串中添加js逻辑 </li>
<li>容易被压缩器压缩掉，yui compressor可以通过<code>/*!</code>来避免被压缩掉，<a href="https://github.com/mishoo/UglifyJS2" target="_blank" rel="external">uglifyjs</a>和<a href="https://developers.google.com/closure/compiler/" target="_blank" rel="external">gcc</a>也可以通过选项配置不删除特定的注释，这个不是大问题</li>
</ul>
<h2 id="coffeescript"><a href="#coffeescript" class="headerlink" title="coffeescript"></a>coffeescript</h2><p>相当于换了一个语言，其实这种语言上缺少的功能，通过<a href="http://coffeescript.org/#strings" target="_blank" rel="external">coffeescript</a>这种以js为编译目标的语言来实现是一种非常棒的选择。    </p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">var tmpl = <span class="string">""" </span></div><div class="line">    !!! 5</div><div class="line">    html</div><div class="line">      include header</div><div class="line">      body</div><div class="line">        //if IE 6</div><div class="line">            .alert.alert-error</div><div class="line">                center 对不起，我们不支持IE6，请升级你的浏览器</div><div class="line">                    a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载</div><div class="line">                    a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载</div><div class="line">        include head</div><div class="line">        .container</div><div class="line">            .row-fluid</div><div class="line">                .span8</div><div class="line">                    block main</div><div class="line">                    include pagerbar</div><div class="line">                .span4</div><div class="line">                    include sidebar</div><div class="line">        include footer</div><div class="line">        include script</div><div class="line">    """</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>易理解，简单，可靠 </li>
</ul>
<p>缺点 :</p>
<ul>
<li>需要了解coffeescript </li>
<li>整个文件都需要用coffeescript来写</li>
</ul>
<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><p>ES6的有一个新的特性，<a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis" target="_blank" rel="external">Template Strings</a>, 这是语言层面上第一次实现了多行字符串, 在<a href="https://www.google.com/intl/en/chrome/browser/canary.html" target="_blank" rel="external">chrome canary</a>里打开<code>Enable Experimental JavaScript</code>就可以使用这个特性，另外<a href="http://www.typescriptlang.org/" target="_blank" rel="external">typescript</a>也会支持这种方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tmpl = </div><div class="line">   <span class="string">`!!! 5</span></div><div class="line">    html</div><div class="line">      include header</div><div class="line">      body</div><div class="line">        //if IE 6</div><div class="line">            .alert.alert-error</div><div class="line">                center 对不起，我们不支持IE6，请升级你的浏览器</div><div class="line">                    a(href="http://windows.microsoft.com/zh-CN/internet-explorer/download-ie") | IE8官方下载</div><div class="line">                    a(href="https://www.google.com/intl/en/chrome/browser/") | Chrome下载</div><div class="line">        include head</div><div class="line">        .container</div><div class="line">            .row-fluid</div><div class="line">                .span8</div><div class="line">                    block main</div><div class="line">                    include pagerbar</div><div class="line">                .span4</div><div class="line">                    include sidebar</div><div class="line">        include footer</div><div class="line">        include script`</div></pre></td></tr></table></figure>
<p>优点:</p>
<ul>
<li>易理解，原生支持 </li>
<li>真正的多行字符串</li>
</ul>
<p>缺点 :</p>
<ul>
<li>JS引擎支持有限 </li>
</ul>
<p>##总结</p>
<p>看了这么些写法，如何选择？如果你用的是coffeescript，放心大胆的使用它支持的多行字符串写法；如果是在客户端，同时你解决了你的压缩器去掉注释的问题，推荐使用heredoc；如果你无法解决压缩器的问题，使用反斜线连接吧，每行只需要加一个字符。</p>

	
	</div>
  <a type="button" href="/2017/02/01/2013-08-20-javascript的几种使用多行字符串的方式/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/neat的使用/" ></a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>#开发环境</p>
<p>##一. neat</p>
<p>###gulp 的使用</p>
<ol>
<li><p><strong>gulp </strong> 需要自己去安装, <code>npm install gulp</code>, 然后 gulpfile.js 文件放入根目录.</p>
</li>
<li><p>安装模板</p>
<pre><code>sudo neat install @ali/generator-apm
</code></pre></li>
</ol>
<p>###yo 的使用</p>
<p>在 neat.fdm 的根目录 </p>
<pre><code>sudo tnpm install generator-polymer
</code></pre><p>##二. apm</p>
<p>是1688开发的<strong>组件</strong>平台, 推荐 <strong>commonjs</strong> 语法来写组件</p>

	
	</div>
  <a type="button" href="/2017/02/01/neat的使用/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-11-09-requirejs/" ></a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<hr>
<p>layout: post<br>date: 2013-11-09  21:11:13 +0800</p>
<h2 id="title-RequireJS小结"><a href="#title-RequireJS小结" class="headerlink" title="title: RequireJS小结"></a>title: RequireJS小结</h2><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>RequireJS是一个工具库，主要用于客户端的模块管理。它可以让客户端的代码分成一个个模块，实现异步或动态加载，从而提高代码的性能和可维护性。它的模块管理遵守<a href="https://github.com/amdjs/amdjs-api/wiki/AMD" target="_blank" rel="external">AMD规范</a>（Asynchronous Module Definition）。</p>
<p>RequireJS的基本思想是，通过define方法，将代码定义为模块；通过require方法，实现代码的模块加载。</p>
<p>首先，将require.js嵌入网页，然后就能在网页中进行模块化编程了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script data-main=<span class="string">"scripts/main"</span> src=<span class="string">"scripts/require.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>上面代码的data-main属性不可省略，用于指定主代码所在的脚本文件，在上例中为scripts子目录下的main.js文件。用户自定义的代码就放在这个main.js文件中。</p>
<h3 id="define方法：定义模块"><a href="#define方法：定义模块" class="headerlink" title="define方法：定义模块"></a>define方法：定义模块</h3><p>define方法用于定义模块，RequireJS要求每个模块放在一个单独的文件里。</p>
<p>按照是否依赖其他模块，可以分成两种情况讨论。第一种情况是定义独立模块，即所定义的模块不依赖其他模块；第二种情况是定义非独立模块，即所定义的模块依赖于其他模块。</p>
<p><strong>（1）独立模块</strong></p>
<p>如果被定义的模块是一个独立模块，不需要依赖任何其他模块，可以直接用define方法生成。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">define(&#123;</div><div class="line">    <span class="attr">method1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</div><div class="line">    <span class="attr">method2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码生成了一个拥有method1、method2两个方法的模块。</p>
<p>另一种等价的写法是，把对象写成一个函数，该函数的返回值就是输出的模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">	    <span class="attr">method1</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</div><div class="line">		<span class="attr">method2</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>后一种写法的自由度更高一点，可以在函数体内写一些模块初始化代码。</p>
<p>值得指出的是，define定义的模块可以返回任何值，不限于对象。</p>
<p><strong>（2）非独立模块</strong></p>
<p>如果被定义的模块需要依赖其他模块，则define方法必须采用下面的格式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'module1'</span>, <span class="string">'module2'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">m1, m2</span>) </span>&#123;</div><div class="line">   ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>define方法的第一个参数是一个数组，它的成员是当前模块所依赖的模块。比如，[‘module1’, ‘module2’]表示我们定义的这个新模块依赖于module1模块和module2模块，只有先加载这两个模块，新模块才能正常运行。一般情况下，module1模块和module2模块指的是，当前目录下的module1.js文件和module2.js文件，等同于写成[‘./module1’, ‘./module2’]。</p>
<p>define方法的第二个参数是一个函数，当前面数组的所有成员加载成功后，它将被调用。它的参数与数组的成员一一对应，比如function(m1, m2)就表示，这个函数的第一个参数m1对应module1模块，第二个参数m2对应module2模块。这个函数必须返回一个对象，供其他模块调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'module1'</span>, <span class="string">'module2'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">m1, m2</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">method</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            m1.methodA();</div><div class="line">			m2.methodB();</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码表示新模块返回一个对象，该对象的method方法就是外部调用的接口，menthod方法内部调用了m1模块的methodA方法和m2模块的methodB方法。</p>
<p>需要注意的是，回调函数必须返回一个对象，这个对象就是你定义的模块。</p>
<p>如果依赖的模块很多，参数与模块一一对应的写法非常麻烦。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">define(</div><div class="line">    [       <span class="string">'dep1'</span>, <span class="string">'dep2'</span>, <span class="string">'dep3'</span>, <span class="string">'dep4'</span>, <span class="string">'dep5'</span>, <span class="string">'dep6'</span>, <span class="string">'dep7'</span>, <span class="string">'dep8'</span>],</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">dep1,   dep2,   dep3,   dep4,   dep5,   dep6,   dep7,   dep8</span>)</span>&#123;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>为了避免像上面代码那样繁琐的写法，RequireJS提供一种更简单的写法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">define(</div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">require</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> dep1 = <span class="built_in">require</span>(<span class="string">'dep1'</span>),</div><div class="line">            dep2 = <span class="built_in">require</span>(<span class="string">'dep2'</span>),</div><div class="line">            dep3 = <span class="built_in">require</span>(<span class="string">'dep3'</span>),</div><div class="line">            dep4 = <span class="built_in">require</span>(<span class="string">'dep4'</span>),</div><div class="line">            dep5 = <span class="built_in">require</span>(<span class="string">'dep5'</span>),</div><div class="line">            dep6 = <span class="built_in">require</span>(<span class="string">'dep6'</span>),</div><div class="line">            dep7 = <span class="built_in">require</span>(<span class="string">'dep7'</span>),</div><div class="line">            dep8 = <span class="built_in">require</span>(<span class="string">'dep8'</span>);</div><div class="line">            ...</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>下面是一个define实际运用的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'math'</span>, <span class="string">'graph'</span>], </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"> math, graph </span>) </span>&#123;</div><div class="line">		<span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">plot</span>: <span class="function"><span class="keyword">function</span>(<span class="params">x, y</span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> graph.drawPie(math.randomGrid(x,y));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>上面代码定义的模块依赖math和graph两个库，然后返回一个具有plot接口的对象。</p>
<blockquote>
<p> RequireJS的模块语法允许它尽快地加载多个模块， 虽然加载的顺序不定，但依赖的顺序最终是正确的。</p>
</blockquote>
<p>另一个实际的例子是，通过判断浏览器是否为IE，而选择加载zepto或jQuery。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define((<span class="string">'__proto__'</span> <span class="keyword">in</span> &#123;&#125; ? [<span class="string">'zepto'</span>] : [<span class="string">'jquery'</span>]), <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> $;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码定义了一个中间模块，该模块先判断浏览器是否支持<strong>proto</strong>属性（除了IE，其他浏览器都支持），如果返回true，就加载zepto库，否则加载jQuery库。</p>
<h3 id="require方法：调用模块"><a href="#require方法：调用模块" class="headerlink" title="require方法：调用模块"></a>require方法：调用模块</h3><p>require方法用于调用模块。它的参数与define方法类似。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">'foo'</span>, <span class="string">'bar'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"> foo, bar </span>) </span>&#123;</div><div class="line">        foo.doSomething();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面方法表示加载foo和bar两个模块，当这两个模块都加载成功后，执行一个回调函数。该回调函数就用来完成具体的任务。</p>
<p>require方法的第一个参数，是一个表示依赖关系的数组。这个数组可以写得很灵活，请看下面的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>( [ <span class="built_in">window</span>.JSON ? <span class="literal">undefined</span> : <span class="string">'util/json2'</span> ], <span class="function"><span class="keyword">function</span> (<span class="params"> JSON </span>) </span>&#123;</div><div class="line">  <span class="built_in">JSON</span> = <span class="built_in">JSON</span> || <span class="built_in">window</span>.JSON;</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log( <span class="built_in">JSON</span>.parse( <span class="string">'&#123; "JSON" : "HERE" &#125;'</span> ) );</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码加载JSON模块时，首先判断浏览器是否原生支持JSON对象。如果是的，则将undefined传入回调函数，否则加载util目录下的json2模块。</p>
<p>require方法也可以用在define方法内部。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params">require</span>) </span>&#123;</div><div class="line">   <span class="keyword">var</span> otherModule = <span class="built_in">require</span>(<span class="string">'otherModule'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>下面的例子显示了如何动态加载模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span> (<span class="params"> require </span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> isReady = <span class="literal">false</span>, foobar;</div><div class="line"> </div><div class="line">    <span class="built_in">require</span>([<span class="string">'foo'</span>, <span class="string">'bar'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">foo, bar</span>) </span>&#123;</div><div class="line">        isReady = <span class="literal">true</span>;</div><div class="line">        foobar = foo() + bar();</div><div class="line">    &#125;);</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">isReady</span>: isReady,</div><div class="line">        <span class="attr">foobar</span>: foobar</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码所定义的模块，内部加载了foo和bar两个模块，在没有加载完成前，isReady属性值为false，加载完成后就变成了true。因此，可以根据isReady属性的值，决定下一步的动作。</p>
<p>下面的例子是模块的输出结果是一个promise对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define([<span class="string">'lib/Deferred'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"> Deferred </span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> defer = <span class="keyword">new</span> Deferred(); </div><div class="line">    <span class="built_in">require</span>([<span class="string">'lib/templates/?index.html'</span>,<span class="string">'lib/data/?stats'</span>],</div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"> template, data </span>)</span>&#123;</div><div class="line">            defer.resolve(&#123; <span class="attr">template</span>: template, <span class="attr">data</span>:data &#125;);</div><div class="line">        &#125;</div><div class="line">    );</div><div class="line">    <span class="keyword">return</span> defer.promise();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码的define方法返回一个promise对象，可以在该对象的then方法，指定下一步的动作。</p>
<p>如果服务器端采用JSONP模式，则可以直接在require中调用，方法是指定JSONP的callback参数为define。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>( [ </div><div class="line">    <span class="string">"http://someapi.com/foo?callback=define"</span></div><div class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>require方法允许添加第三个参数，即错误处理的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(</div><div class="line">    [ <span class="string">"backbone"</span> ], </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"> Backbone </span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> Backbone.View.extend(&#123; <span class="comment">/* ... */</span> &#125;);</div><div class="line">    &#125;, </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">		<span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>require方法的第三个参数，即处理错误的回调函数，接受一个error对象作为参数。</p>
<p>require对象还允许指定一个全局性的Error事件的监听函数。所有没有被上面的方法捕获的错误，都会被触发这个监听函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">requirejs.onError = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="AMD模式小结"><a href="#AMD模式小结" class="headerlink" title="AMD模式小结"></a>AMD模式小结</h3><p>define和require这两个定义模块、调用模块的方法，合称为AMD模式。它的模块定义的方法非常清晰，不会污染全局环境，能够清楚地显示依赖关系。</p>
<p>AMD模式可以用于浏览器环境，并且允许非同步加载模块，也可以根据需要动态加载模块。</p>
<h2 id="配置require-js：config方法"><a href="#配置require-js：config方法" class="headerlink" title="配置require.js：config方法"></a>配置require.js：config方法</h2><p>require方法本身也是一个对象，它带有一个config方法，用来配置require.js运行参数。config方法接受一个对象作为参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">paths</span>: &#123;</div><div class="line">        <span class="attr">jquery</span>: [</div><div class="line">            <span class="string">'//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js'</span>,</div><div class="line">            <span class="string">'lib/jquery'</span></div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>config方法的参数对象有以下主要成员：</p>
<p><strong>（1）paths</strong></p>
<p>paths参数指定各个模块的位置。这个位置可以是同一个服务器上的相对位置，也可以是外部网址。可以为每个模块定义多个位置，如果第一个位置加载失败，则加载第二个位置，上面的示例就表示如果CDN加载失败，则加载服务器上的备用脚本。需要注意的是，指定本地文件路径时，可以省略文件最后的js后缀名。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>([<span class="string">"jquery"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码加载jquery模块，因为jquery的路径已经在paths参数中定义了，所以就会到事先设定的位置下载。</p>
<p><strong>（2）baseUrl</strong></p>
<p>baseUrl参数指定本地模块位置的基准目录，即本地模块的路径是相对于哪个目录的。该属性通常由require.js加载时的data-main属性指定。</p>
<p><strong>（3）shim</strong></p>
<p>有些库不是AMD兼容的，这时就需要指定shim属性的值。shim可以理解成“垫片”，用来帮助require.js加载非AMD规范的库。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>.config(&#123;</div><div class="line">    <span class="attr">paths</span>: &#123;</div><div class="line">        <span class="string">"backbone"</span>: <span class="string">"vendor/backbone"</span>,</div><div class="line">        <span class="string">"underscore"</span>: <span class="string">"vendor/underscore"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">shim</span>: &#123;</div><div class="line">        <span class="string">"backbone"</span>: &#123;</div><div class="line">            <span class="attr">deps</span>: [ <span class="string">"underscore"</span> ],</div><div class="line">            <span class="attr">exports</span>: <span class="string">"Backbone"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"underscore"</span>: &#123;</div><div class="line">            <span class="attr">exports</span>: <span class="string">"_"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码中的backbone和underscore就是非AMD规范的库。shim指定它们的依赖关系（backbone依赖于underscore），以及输出符号（backbone为“Backbone”，underscore为“_”）。</p>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>RequireJS允许使用插件，加载各种格式的数据。完整的插件清单可以查看<a href="https://github.com/jrburke/requirejs/wiki/Plugins" target="_blank" rel="external">官方网站</a>。</p>
<p>下面是插入文本数据所使用的text插件的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">define([</div><div class="line">    <span class="string">'backbone'</span>,</div><div class="line">    <span class="string">'text!templates.html'</span></div><div class="line">], <span class="function"><span class="keyword">function</span>(<span class="params"> Backbone, template </span>)</span>&#123;</div><div class="line">   <span class="comment">// ...</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>上面代码加载的第一个模块是backbone，第二个模块则是一个文本，用’text!’表示。该文本作为字符串，存放在回调函数的template变量中。</p>
<h2 id="优化器r-js"><a href="#优化器r-js" class="headerlink" title="优化器r.js"></a>优化器r.js</h2><p>RequireJS提供一个基于node.js的命令行工具r.js，用来压缩多个js文件。它的主要作用是将多个模块文件压缩合并成一个脚本文件，以减少网页的HTTP请求数。</p>
<p>第一步是安装r.js（假设已经安装了node.js）。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm <span class="keyword">install</span> -g requirejs</div></pre></td></tr></table></figure>
<p>然后，使用的时候，直接在命令行键入以下格式的命令。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">node</span> <span class="title">r</span>.js -o <span class="tag">&lt;arguments&gt;</span></div></pre></td></tr></table></figure>
<p>&lt;argument&gt;表示命令运行时，所需要的一系列参数，比如像下面这样：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">node</span> <span class="title">r</span>.js -o <span class="attr">baseUrl=</span>. <span class="attr">name=</span>main <span class="attr">out=</span>main-built.js</div></pre></td></tr></table></figure>
<p>除了直接在命令行提供参数设置，也可以将参数写入一个文件，假定文件名为build.js。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(&#123;</div><div class="line">    <span class="attr">baseUrl</span>: <span class="string">"."</span>,</div><div class="line">    <span class="attr">name</span>: <span class="string">"main"</span>,</div><div class="line">    <span class="attr">out</span>: <span class="string">"main-built.js"</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>然后，在命令行下用r.js运行这个参数文件，就OK了，不需要其他步骤了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node r.js -o build.js</div></pre></td></tr></table></figure>
<p>下面是一个参数文件的范例，假定位置就在根目录下，文件名为build.js。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(&#123;</div><div class="line">    <span class="attr">appDir</span>: <span class="string">'./'</span>,</div><div class="line">    <span class="attr">baseUrl</span>: <span class="string">'./js'</span>,</div><div class="line">    <span class="attr">dir</span>: <span class="string">'./dist'</span>,</div><div class="line">    <span class="attr">modules</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">'main'</span></div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">fileExclusionRegExp</span>: <span class="regexp">/^(r|build)\.js$/</span>,</div><div class="line">    <span class="attr">optimizeCss</span>: <span class="string">'standard'</span>,</div><div class="line">    <span class="attr">removeCombined</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">paths</span>: &#123;</div><div class="line">        <span class="attr">jquery</span>: <span class="string">'lib/jquery'</span>,</div><div class="line">        <span class="attr">underscore</span>: <span class="string">'lib/underscore'</span>,</div><div class="line">        <span class="attr">backbone</span>: <span class="string">'lib/backbone/backbone'</span>,</div><div class="line">        <span class="attr">backboneLocalstorage</span>: <span class="string">'lib/backbone/backbone.localStorage'</span>,</div><div class="line">        <span class="attr">text</span>: <span class="string">'lib/require/text'</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">shim</span>: &#123;</div><div class="line">        <span class="attr">underscore</span>: &#123;</div><div class="line">            <span class="attr">exports</span>: <span class="string">'_'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">backbone</span>: &#123;</div><div class="line">            <span class="attr">deps</span>: [</div><div class="line">                <span class="string">'underscore'</span>,</div><div class="line">                <span class="string">'jquery'</span></div><div class="line">            ],</div><div class="line">            <span class="attr">exports</span>: <span class="string">'Backbone'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">backboneLocalstorage</span>: &#123;</div><div class="line">            <span class="attr">deps</span>: [<span class="string">'backbone'</span>],</div><div class="line">            <span class="attr">exports</span>: <span class="string">'Store'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>上面代码将多个模块压缩合并成一个main.js。</p>
<p>参数文件的主要成员解释如下：</p>
<ul>
<li><p><strong>appDir</strong>：项目目录，相对于参数文件的位置。</p>
</li>
<li><p><strong>baseUrl</strong>：js文件的位置。</p>
</li>
<li><p><strong>dir</strong>：输出目录。</p>
</li>
<li><p><strong>modules</strong>：一个包含对象的数组，每个对象就是一个要被优化的模块。</p>
</li>
<li><p><strong>fileExclusionRegExp</strong>：凡是匹配这个正则表达式的文件名，都不会被拷贝到输出目录。</p>
</li>
<li><p><strong>optimizeCss</strong>: 自动压缩CSS文件，可取的值包括“none”, “standard”, “standard.keepLines”, “standard.keepComments”, “standard.keepComments.keepLines”。</p>
</li>
<li><p><strong>removeCombined</strong>：如果为true，合并后的原文件将不保留在输出目录中。</p>
</li>
<li><p><strong>paths</strong>：各个模块的相对路径，可以省略js后缀名。</p>
</li>
<li><p><strong>shim</strong>：配置依赖性关系。如果某一个模块不是AMD模式定义的，就可以用shim属性指定模块的依赖性关系和输出值。</p>
</li>
<li><p><strong>generateSourceMaps</strong>：是否要生成source map文件。</p>
</li>
</ul>
<p>更详细的解释可以参考<a href="https://github.com/jrburke/r.js/blob/master/build/example.build.js" target="_blank" rel="external">官方文档</a>。</p>
<p>运行优化命令后，可以前往dist目录查看优化后的文件。</p>
<p>下面是另一个build.js的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">(&#123;</div><div class="line">    <span class="attr">mainConfigFile</span> : <span class="string">"js/main.js"</span>,</div><div class="line">    <span class="attr">baseUrl</span>: <span class="string">"js"</span>,</div><div class="line">    <span class="attr">removeCombined</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">findNestedDependencies</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">dir</span>: <span class="string">"dist"</span>,</div><div class="line">    <span class="attr">modules</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"main"</span>,</div><div class="line">            <span class="attr">exclude</span>: [</div><div class="line">                <span class="string">"infrastructure"</span></div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"infrastructure"</span></div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>上面代码将模块文件压缩合并成两个文件，第一个是main.js（指定排除infrastructure.js），第二个则是infrastructure.js。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li>NaorYe, <a href="http://www.webdeveasy.com/optimize-requirejs-projects/" target="_blank" rel="external">Optimize (Concatenate and Minify) RequireJS Projects</a></li>
<li>Jonathan Creamer, <a href="http://tech.pro/tutorial/1300/deep-dive-into-requirejs" target="_blank" rel="external">Deep dive into Require.js</a></li>
<li>Addy Osmani, <a href="http://addyosmani.com/writing-modular-js/" target="_blank" rel="external">Writing Modular JavaScript With AMD, CommonJS &amp; ES Harmony</a> </li>
<li>Jim Cowart, <a href="http://tech.pro/blog/1561/five-helpful-tips-when-using-requirejs" target="_blank" rel="external">Five Helpful Tips When Using RequireJS</a> </li>
<li>Jim Cowart, <a href="http://tech.pro/blog/1639/using-rjs-to-optimize-your-requirejs-project" target="_blank" rel="external">Using r.js to Optimize Your RequireJS Project</a></li>
</ul>

	
	</div>
  <a type="button" href="/2017/02/01/2013-11-09-requirejs/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2017-02-01 </div>
			<div class="article-title"><a href="/2017/02/01/2013-11-13-如何在karma里载入html文件进行测试/" >如何在karma里载入html文件进行测试</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>因为要测试代码在iframe里的运行情况，必须载入一个html文件，然后判断该文件里的js执行情况，在karma里无法直接载入一个html文件，同时由于路径的变更，测试同样跑不过，下面是详述原因和解决办法</p>
<h2 id="需要测试的场景"><a href="#需要测试的场景" class="headerlink" title="需要测试的场景"></a>需要测试的场景</h2><p>当前工程的目录结构如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── Gruntfile<span class="selector-class">.js</span></div><div class="line">├── karma<span class="selector-class">.conf</span><span class="selector-class">.js</span></div><div class="line">├── package<span class="selector-class">.json</span></div><div class="line">├── src</div><div class="line">│   ├── source<span class="selector-class">.js</span></div><div class="line">├── test</div><div class="line">│   ├── iframes</div><div class="line">│   │   ├── hello<span class="selector-class">.html</span></div><div class="line">│   ├── lib</div><div class="line">│   ├── mainSpec<span class="selector-class">.js</span></div><div class="line">│   └── runner.html</div></pre></td></tr></table></figure>
<p>在mainSpec.js里写入一个iframe到当前<code>document</code>下，路径为<code>iframes/hello.html</code>,<br><code>hello.html</code>里会引入<code>souce.js</code>，然后进行一些操作，<code>mainSpec.js</code><br>再对写入iframe进行检测，判断执行结果</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>有两个问题需要解决</p>
<ul>
<li>karma会把html文件当作js载入，也就是它会使用一个script标签把文件载入 </li>
<li>karma对于html文件使用html-js预处理，页面中输出的是一个hello.html.js</li>
</ul>
<p>在karma.conf.js里配置一下files对象解决问题1, served默认是true,也可以不加的，详细可以<a href="http://karma-runner.github.io/0.10/config/files.html" target="_blank" rel="external">官方文档</a></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="string">files:</span> [</div><div class="line">             <span class="string">'test/lib/**/*.js'</span>,</div><div class="line">             <span class="string">'src/source.js'</span>,</div><div class="line">             <span class="string">'test/mainSpec.js'</span>,</div><div class="line">             &#123; <span class="string">pattern:</span> <span class="string">'test/iframes/*'</span>, <span class="string">included:</span> <span class="literal">false</span>, <span class="string">served:</span> <span class="literal">true</span> &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>在karma.conf.js里覆盖掉默认的html-js预处理</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">preprocessors:</span> &#123;</div><div class="line">    <span class="string">'test/iframes/*'</span>: [<span class="string">''</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="路径的问题"><a href="#路径的问题" class="headerlink" title="路径的问题"></a>路径的问题</h2><p>看样子是正常了，运行一下<code>karma run</code>，还是报错，我们写入的路径是<code>./iframes/hello.html</code>，<br>这是由于karma默认的执行路径是<code>http://localhost:9876/debug.html</code>，写入的路径会变成<code>http://localhost:9876/iframes/hello.html</code>，而karma会把当前目录放在<code>/base/</code>下(<a href="/2013/08/21/karma%E4%B8%8B%E6%B5%8B%E8%AF%95%E5%BC%82%E6%AD%A5%E8%BD%BD%E5%85%A5%E7%9A%84js%E6%96%87%E4%BB%B6.html">这里介绍过</a>)，很明显会404。</p>
<p>可以很直接的把写入的路径变成<code>/base/test/iframes/hello.html</code>，但是这样，这个测试就严重依赖karma了，你可能注意到test目录下还有一个runner.html，这个文件我们可以手工运行，如果写成了前面的这个路径，手工运行就完全不行。为了保证runner.html的正常工作,我们必须使用相对路径。</p>
<p>改造一下mainSpec.js，区别对待karma环境和普通环境中载入的iframe的路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPath</span>(<span class="params">path</span>) </span>&#123;</div><div class="line">       <span class="keyword">if</span> (<span class="built_in">window</span>.__karma__) &#123;</div><div class="line">           <span class="keyword">return</span> path.replace(<span class="regexp">/\.\//</span>, <span class="string">'/base/test/'</span>)</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           <span class="keyword">return</span> path</div><div class="line">       &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//写入文件的时候</span></div><div class="line">...</div><div class="line">iframe.src = getPath(<span class="string">'./iframes/hello.html'</span>)</div><div class="line">...</div></pre></td></tr></table></figure>
<p>这样之后我们的代码就可以正常的在karma和普通环境中跑测试了。</p>

	
	</div>
  <a type="button" href="/2017/02/01/2013-11-13-如何在karma里载入html文件进行测试/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/3/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			 

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Sports/Baseball/">Baseball<span>2</span></a></li>
		
			<li><a href="/categories/Sports/">Sports<span>2</span></a></li>
		
			<li><a href="/categories/bom/">bom<span>1</span></a></li>
		
			<li><a href="/categories/collection/">collection<span>1</span></a></li>
		
			<li><a href="/categories/css/">css<span>1</span></a></li>
		
			<li><a href="/categories/http/">http<span>1</span></a></li>
		
			<li><a href="/categories/javascript-template/">javascript template<span>1</span></a></li>
		
			<li><a href="/categories/javascript-test/">javascript test<span>1</span></a></li>
		
			<li><a href="/categories/jquery/">jquery<span>1</span></a></li>
		
			<li><a href="/categories/library/">library<span>2</span></a></li>
		
			<li><a href="/categories/note/">note<span>1</span></a></li>
		
			<li><a href="/categories/note-vim/">note vim<span>2</span></a></li>
		
			<li><a href="/categories/tool/">tool<span>3</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/browser/">browser<span>3</span></a></li>
		
			<li><a href="/tags/w3c/">w3c<span>1</span></a></li>
		
			<li><a href="/tags/default/">default<span>1</span></a></li>
		
			<li><a href="/tags/hg/">hg<span>1</span></a></li>
		
			<li><a href="/tags/mac/">mac<span>1</span></a></li>
		
			<li><a href="/tags/library/">library<span>3</span></a></li>
		
			<li><a href="/tags/demo/">demo<span>1</span></a></li>
		
			<li><a href="/tags/javascript/">javascript<span>9</span></a></li>
		
			<li><a href="/tags/polymer/">polymer<span>3</span></a></li>
		
			<li><a href="/tags/test/">test<span>2</span></a></li>
		
			<li><a href="/tags/Shocking/">Shocking<span>2</span></a></li>
		
			<li><a href="/tags/html/">html<span>2</span></a></li>
		
			<li><a href="/tags/http/">http<span>2</span></a></li>
		
			<li><a href="/tags/regexp/">regexp<span>6</span></a></li>
		
			<li><a href="/tags/webponent/">webponent<span>1</span></a></li>
		
			<li><a href="/tags/webcomponent/">webcomponent<span>2</span></a></li>
		
			<li><a href="/tags/build/">build<span>2</span></a></li>
		
			<li><a href="/tags/git/">git<span>5</span></a></li>
		
			<li><a href="/tags/jquery/">jquery<span>3</span></a></li>
		
			<li><a href="/tags/javascript-regexp/">javascript regexp<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>39</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2017/02/01/2012-08-03-XMLHttpRequest发送put,delete请求/" ><i class="fa fa-file-o"></i>XMLHttpRequest发送put,delete请求</a>
      </li>
    
      <li>
        <a href="/2017/02/01/消除函数的术语歧义/" ><i class="fa fa-file-o"></i></a>
      </li>
    
      <li>
        <a href="/2017/02/01/2012-08-03-页面性能的几个评测点/" ><i class="fa fa-file-o"></i>页面性能的几个评测点</a>
      </li>
    
      <li>
        <a href="/2017/02/01/代码质量的分类/" ><i class="fa fa-file-o"></i></a>
      </li>
    
      <li>
        <a href="/2017/02/01/设计模式简介/" ><i class="fa fa-file-o"></i></a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/chenyakun" title="My Github repository." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2017 yakun.cyk
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  
  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<!-- <script src="/js/search.js"></script>  -->

<!-- 
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>
 -->

<!-- 
   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>
 -->

<div class="cb-search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
        opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">

    <input type="text" class="cb-search-content" id="cb-search-content" style="position: fixed; top: 60px" placeholder="文章标题 日期 标签" />

    <div style="position: fixed; top: 16px; right: 16px;">
        <img src="/search/img/cb-close.png"  id="cb-close-btn"/>
    </div>
</div>

<!-- <div style="position: fixed; right: 16px; bottom: 20px;">
    <img src="/search/img/cb-search.png"  id="cb-search-btn"  title="双击ctrl试一下"/>
</div> -->

<link rel="stylesheet" href="/search/css/cb-search.css">
<script src="/search/js/bootstrap3-typeahead.min.js"></script>
<script src="/search/js/cb-search.js"></script>

</body>
   </html>
